<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carta de San Valent√≠n</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      overflow: hidden; 
      background: linear-gradient(135deg, #1a0a1e 0%, #2d1b30 50%, #1a0a1e 100%);
      font-family: 'Georgia', serif; 
      min-height: 100vh;
    }
    canvas { display: block; position: fixed; top: 0; left: 0; }
    
    .pantalla {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s ease;
      z-index: 10;
    }
    
    .pantalla.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .pantalla.oculta {
      opacity: 0;
      pointer-events: none;
    }

    /* === Pantalla de Carga === */
    .loading-screen {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: linear-gradient(135deg, #1a0a1e 0%, #2d1b30 50%, #1a0a1e 100%);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      transition: opacity 0.8s ease;
    }

    .loading-screen.ocultar {
      opacity: 0;
      pointer-events: none;
    }

    .pato-caminando {
      width: 80px;
      height: 80px;
      position: relative;
      animation: pato-caminar-rebote 0.6s ease-in-out infinite;
      margin-bottom: 30px;
    }

    @keyframes pato-caminar-rebote {
      0%, 100% { transform: translateY(0) rotate(-3deg); }
      50% { transform: translateY(-12px) rotate(3deg); }
    }

    .pato-caminando svg {
      width: 100%;
      height: 100%;
    }

    .loading-patas {
      animation: patas-mover 0.3s linear infinite;
      transform-origin: center top;
    }

    @keyframes patas-mover {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }

    .loading-texto {
      color: #ffd4e5;
      font-size: 1.1rem;
      font-style: italic;
      margin-bottom: 20px;
      animation: loading-dots 1.5s infinite;
    }

    @keyframes loading-dots {
      0% { content: ''; }
      33% { opacity: 0.6; }
      66% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    .loading-barra-fondo {
      width: clamp(200px, 60vw, 300px);
      height: 6px;
      background: rgba(255, 105, 180, 0.15);
      border-radius: 3px;
      overflow: hidden;
    }

    .loading-barra {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ff1493, #ff69b4, #da70d6);
      border-radius: 3px;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px rgba(255, 105, 180, 0.5);
    }

    .loading-huellas {
      position: absolute;
      bottom: 15%;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 30px;
      opacity: 0.2;
    }

    .huella {
      font-size: 1rem;
      animation: huella-aparecer 2s ease infinite;
    }

    .huella:nth-child(2) { animation-delay: 0.3s; }
    .huella:nth-child(3) { animation-delay: 0.6s; }
    .huella:nth-child(4) { animation-delay: 0.9s; }
    .huella:nth-child(5) { animation-delay: 1.2s; }

    @keyframes huella-aparecer {
      0%, 100% { opacity: 0.1; transform: scale(0.8); }
      50% { opacity: 0.4; transform: scale(1); }
    }

    /* === Sobre 3D con canvas === */
    .sobre-3d-container {
      position: relative;
      z-index: 10;
      cursor: pointer;
    }

    .sobre-3d-container canvas {
      width: clamp(280px, 70vw, 420px) !important;
      height: clamp(250px, 60vw, 380px) !important;
    }

    .click-hint {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      color: #e0bebe;
      font-size: 0.85rem;
      white-space: nowrap;
      animation: pulse-hint 2.5s ease-in-out infinite;
      letter-spacing: 2px;
      font-style: italic;
    }

    @keyframes pulse-hint {
      0%, 100% { opacity: 0.4; transform: translateX(-50%) translateY(0); }
      50% { opacity: 1; transform: translateX(-50%) translateY(-5px); }
    }

    .corazon-flotante {
      position: absolute;
      font-size: 1.2rem;
      opacity: 0;
      animation: corazon-subir 4s ease-in-out infinite;
      pointer-events: none;
      z-index: 0;
    }

    @keyframes corazon-subir {
      0% { opacity: 0; transform: translateY(20px) scale(0.5); }
      20% { opacity: 0.6; }
      80% { opacity: 0.4; }
      100% { opacity: 0; transform: translateY(-80px) scale(1) rotate(20deg); }
    }

    /* Mensaje de la primera pantalla */
    .mensaje {
      color: #ffd4e5;
      font-size: clamp(1.2rem, 4vw, 2rem);
      text-align: center;
      max-width: 80%;
      line-height: 1.8;
      text-shadow: 0 0 30px #ff1493, 0 0 60px #ff0066;
      padding: 20px;
    }

    .mensaje-final {
      font-size: clamp(2rem, 8vw, 4rem);
      color: #ff69b4;
      text-shadow: 0 0 40px #ff1493, 0 0 80px #ff0066, 0 0 120px #ff69b4;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    /* Pantalla Orquideas - transicion hacia la derecha */
    .pantalla.slide-right-enter {
      transform: translateX(100%);
      opacity: 0;
    }

    .pantalla.slide-right-visible {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
      transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.8s ease;
    }

    .pantalla.slide-right-exit {
      transform: translateX(-100%);
      opacity: 0;
      pointer-events: none;
      transition: transform 1s cubic-bezier(0.25, 0.46, 0.45, 0.94), opacity 0.8s ease;
    }

    /* Orquideas decorativas */
    .orquidea-decorativa {
      position: absolute;
      font-size: 2.8rem;
      opacity: 0;
      animation: orquidea-aparecer 1.5s ease forwards, orquidea-flotar 5s ease-in-out infinite;
      filter: drop-shadow(0 0 15px rgba(186, 85, 211, 0.8));
    }

    @keyframes orquidea-aparecer {
      0% { opacity: 0; transform: scale(0) rotate(-30deg); }
      100% { opacity: 0.8; transform: scale(1) rotate(0deg); }
    }

    @keyframes orquidea-flotar {
      0%, 100% { transform: translateY(0) rotate(0deg) scale(1); }
      25% { transform: translateY(-12px) rotate(5deg) scale(1.05); }
      50% { transform: translateY(-20px) rotate(-3deg) scale(1.1); }
      75% { transform: translateY(-8px) rotate(7deg) scale(1.03); }
    }

    .mensaje-orquidea {
      color: #e8c8f0;
      font-size: clamp(1.1rem, 3.5vw, 1.8rem);
      text-align: center;
      max-width: 80%;
      line-height: 2;
      text-shadow: 0 0 30px #9b30ff, 0 0 60px #8b00ff, 0 0 90px #ba55d3;
      padding: 30px;
      background: radial-gradient(ellipse at center, rgba(75, 0, 130, 0.2) 0%, transparent 70%);
      border-radius: 20px;
      animation: mensaje-glow 3s ease-in-out infinite alternate;
      position: relative;
      z-index: 5;
    }

    @keyframes mensaje-glow {
      0% { text-shadow: 0 0 30px #9b30ff, 0 0 60px #8b00ff, 0 0 90px #ba55d3; }
      100% { text-shadow: 0 0 40px #da70d6, 0 0 80px #9b30ff, 0 0 120px #ba55d3, 0 0 160px #8b008b; }
    }

    /* Efecto de brillo flotante para orquideas */
    .brillo-orquidea {
      position: absolute;
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: #da70d6;
      box-shadow: 0 0 10px #da70d6, 0 0 20px #ba55d3, 0 0 40px #9b30ff;
      animation: brillo-flotar 4s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes brillo-flotar {
      0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
      20% { opacity: 1; }
      80% { opacity: 1; }
      50% { transform: translateY(-60px) scale(1.5); }
      100% { opacity: 0; transform: translateY(-100px) scale(0.3); }
    }

    /* Lineas de luz decorativas */
    .linea-luz {
      position: absolute;
      width: 2px;
      height: 80px;
      background: linear-gradient(to top, transparent, rgba(186, 85, 211, 0.6), transparent);
      animation: linea-subir 3s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes linea-subir {
      0%, 100% { opacity: 0; transform: translateY(30px); }
      50% { opacity: 0.7; transform: translateY(-30px); }
    }

    .btn-siguiente {
      margin-top: 30px;
      margin-bottom: 50px;
      padding: 15px 50px;
      font-size: 1.2rem;
      background: linear-gradient(45deg, #ff1493, #ff69b4);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 30px;
      color: white;
      cursor: pointer;
      z-index: 20;
      box-shadow: 0 0 30px rgba(255, 105, 180, 0.5);
      transition: all 0.3s ease;
      font-family: 'Georgia', serif;
      position: relative;
    }

    .btn-siguiente:hover {
      transform: scale(1.1);
      box-shadow: 0 0 50px #ff1493;
    }

    /* Zoom al hacer click en imagenes */
    .foto-zoom-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 200;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      transition: opacity 0.4s ease;
      cursor: pointer;
      backdrop-filter: blur(5px);
    }

    .foto-zoom-overlay.activo {
      opacity: 1;
    }

    .foto-zoom-overlay img {
      max-width: 90vw;
      max-height: 85vh;
      object-fit: contain;
      border-radius: 10px;
      box-shadow: 0 0 60px rgba(255, 105, 180, 0.4);
      transform: scale(0.5);
      transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .foto-zoom-overlay.activo img {
      transform: scale(1);
    }

    .foto-zoom-cerrar {
      position: absolute;
      top: 20px;
      right: 25px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.3s;
      z-index: 201;
    }

    .foto-zoom-cerrar:hover {
      opacity: 1;
    }

    .rosa-decorativa {
      position: absolute;
      font-size: 3rem;
      opacity: 0.6;
      animation: flotar 4s ease-in-out infinite;
      filter: drop-shadow(0 0 10px #ff1493);
    }

    @keyframes flotar {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }

    .indicador-pestanas {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 30;
    }

    .punto {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 105, 180, 0.3);
      transition: all 0.5s ease;
    }

    .punto.activo {
      background: #ff69b4;
      box-shadow: 0 0 15px #ff1493;
      transform: scale(1.3);
    }

    .corazon-sello {
      position: absolute;
      top: -20px;
      right: 30px;
      font-size: 2rem;
      z-index: 3;
      filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
    }

    /* === Pantalla Postales / Fotos === */
    .postales-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      perspective: 1200px;
      overflow: hidden;
    }

    .postal {
      position: absolute;
      width: clamp(200px, 35vw, 320px);
      background: #faf3e8;
      padding: 12px 12px 40px 12px;
      border-radius: 4px;
      box-shadow:
        0 4px 8px rgba(0,0,0,0.15),
        0 15px 40px rgba(0,0,0,0.25),
        inset 0 0 30px rgba(139, 90, 43, 0.08);
      transition: transform 0.1s ease-out, box-shadow 0.3s ease;
      cursor: default;
      transform-style: preserve-3d;
    }

    .postal::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 2px solid rgba(139, 90, 43, 0.15);
      border-radius: 4px;
      pointer-events: none;
    }

    .postal::after {
      content: '';
      position: absolute;
      top: 6px;
      left: 6px;
      right: 6px;
      bottom: 34px;
      border: 1px dashed rgba(139, 90, 43, 0.2);
      border-radius: 2px;
      pointer-events: none;
    }

    .postal img {
      width: 100%;
      height: clamp(150px, 25vw, 240px);
      object-fit: cover;
      border-radius: 2px;
      display: block;
      filter: saturate(1.1) contrast(1.05);
      cursor: pointer;
      transition: filter 0.3s ease;
    }

    .postal img:hover {
      filter: saturate(1.3) contrast(1.1) brightness(1.05);
    }

    .postal-sello {
      position: absolute;
      top: 10px;
      right: 14px;
      width: 50px;
      height: 60px;
      background: linear-gradient(135deg, #e8395a, #ff6b8a);
      border-radius: 3px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.6rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      border: 2px solid rgba(255,255,255,0.3);
      z-index: 2;
    }

    .postal-sello::before {
      content: '';
      position: absolute;
      top: -3px; left: -3px; right: -3px; bottom: -3px;
      background: repeating-conic-gradient(#faf3e8 0% 25%, transparent 0% 50%) 50% / 8px 8px;
      border-radius: 3px;
      z-index: -1;
    }

    .postal-matasellos {
      position: absolute;
      top: 14px;
      right: 70px;
      width: 55px;
      height: 55px;
      border: 2px solid rgba(180, 50, 50, 0.3);
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 0.5rem;
      color: rgba(180, 50, 50, 0.4);
      transform: rotate(-15deg);
      font-family: monospace;
      z-index: 2;
    }

    .postal-matasellos::after {
      content: '';
      position: absolute;
      left: -8px;
      right: -8px;
      top: 50%;
      height: 2px;
      background: repeating-linear-gradient(90deg, rgba(180,50,50,0.3) 0px, rgba(180,50,50,0.3) 4px, transparent 4px, transparent 8px);
    }

    .postal-texto {
      position: absolute;
      bottom: 8px;
      left: 0;
      right: 0;
      text-align: center;
      font-family: 'Georgia', serif;
      font-size: clamp(0.6rem, 1.5vw, 0.85rem);
      color: #8b5a2b;
      font-style: italic;
      letter-spacing: 1px;
    }

    .postal-lineas {
      position: absolute;
      bottom: 30px;
      right: 14px;
      width: 40%;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .postal-lineas span {
      display: block;
      height: 1px;
      background: rgba(139, 90, 43, 0.2);
    }

    /* Posiciones y rotaciones de cada postal */
    .postal-1 {
      transform: rotate(-8deg) translateZ(0px);
      z-index: 1;
      left: 5%;
      top: 15%;
    }

    .postal-2 {
      transform: rotate(5deg) translateZ(20px);
      z-index: 2;
      left: 35%;
      top: 25%;
    }

    .postal-3 {
      transform: rotate(-3deg) translateZ(40px);
      z-index: 3;
      right: 5%;
      top: 10%;
    }

    /* Animacion de entrada escalonada */
    .postal-aparecer {
      animation: postal-entrada 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
      opacity: 0;
    }

    .postal-1.postal-aparecer { animation-delay: 0.2s; }
    .postal-2.postal-aparecer { animation-delay: 0.6s; }
    .postal-3.postal-aparecer { animation-delay: 1s; }

    @keyframes postal-entrada {
      0% {
        opacity: 0;
        transform: translateY(80px) rotate(0deg) scale(0.7);
      }
      100% {
        opacity: 1;
      }
    }

    .postal-1.postal-aparecer {
      animation: postal-entrada-1 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 0.2s forwards;
    }
    .postal-2.postal-aparecer {
      animation: postal-entrada-2 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 0.6s forwards;
    }
    .postal-3.postal-aparecer {
      animation: postal-entrada-3 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) 1s forwards;
    }

    @keyframes postal-entrada-1 {
      0% { opacity: 0; transform: translateY(80px) rotate(0deg) scale(0.7); }
      100% { opacity: 1; transform: rotate(-8deg) translateZ(0px); }
    }
    @keyframes postal-entrada-2 {
      0% { opacity: 0; transform: translateY(80px) rotate(0deg) scale(0.7); }
      100% { opacity: 1; transform: rotate(5deg) translateZ(20px); }
    }
    @keyframes postal-entrada-3 {
      0% { opacity: 0; transform: translateY(80px) rotate(0deg) scale(0.7); }
      100% { opacity: 1; transform: rotate(-3deg) translateZ(40px); }
    }

    .titulo-postales {
      position: absolute;
      bottom: 12%;
      left: 50%;
      transform: translateX(-50%);
      color: #ffd4e5;
      font-size: clamp(1rem, 3vw, 1.6rem);
      text-align: center;
      text-shadow: 0 0 20px #ff1493, 0 0 40px #ff0066;
      white-space: nowrap;
      z-index: 10;
      opacity: 0;
      animation: titulo-postal-fade 1s ease 1.5s forwards;
    }

    @keyframes titulo-postal-fade {
      to { opacity: 1; }
    }

    /* === Pantalla Boda === */
    .boda-container {
      position: relative;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      perspective: 1000px;
      overflow: hidden;
    }

    .texto-arco {
      position: relative;
      width: clamp(320px, 85vw, 700px);
      height: clamp(100px, 18vh, 160px);
      margin-bottom: 25px;
      z-index: 5;
    }

    .texto-arco svg {
      width: 100%;
      height: 100%;
      overflow: visible;
    }

    .texto-arco textPath {
      fill: #ffd700;
      font-family: 'Georgia', serif;
      font-size: 24px;
      font-style: italic;
      letter-spacing: 1.5px;
    }

    .texto-arco-glow {
      filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))
             drop-shadow(0 0 25px rgba(255, 105, 180, 0.4))
             drop-shadow(0 0 50px rgba(255, 215, 0, 0.3));
      animation: arco-brillo 3s ease-in-out infinite alternate;
    }

    @keyframes arco-brillo {
      0% {
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.6))
               drop-shadow(0 0 25px rgba(255, 105, 180, 0.4))
               drop-shadow(0 0 50px rgba(255, 215, 0, 0.3));
      }
      100% {
        filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.9))
               drop-shadow(0 0 40px rgba(255, 105, 180, 0.6))
               drop-shadow(0 0 70px rgba(255, 215, 0, 0.5));
      }
    }

    .fotos-boda-grid {
      display: flex;
      gap: clamp(10px, 2vw, 25px);
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      z-index: 5;
      perspective: 800px;
    }

    .foto-boda {
      width: clamp(140px, 25vw, 220px);
      height: clamp(180px, 32vw, 290px);
      background: #fff;
      padding: 8px 8px 35px 8px;
      border-radius: 3px;
      box-shadow:
        0 6px 20px rgba(0,0,0,0.3),
        0 20px 50px rgba(0,0,0,0.15),
        inset 0 0 20px rgba(255, 215, 0, 0.05);
      transition: transform 0.15s ease-out;
      transform-style: preserve-3d;
      opacity: 0;
      position: relative;
      overflow: visible;
    }

    .foto-boda::before {
      content: '';
      position: absolute;
      top: 3px; left: 3px; right: 3px; bottom: 30px;
      border: 1px solid rgba(212, 175, 55, 0.25);
      border-radius: 2px;
      pointer-events: none;
    }

    .foto-boda::after {
      content: 'üíç';
      position: absolute;
      bottom: 8px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1rem;
      opacity: 0.6;
    }

    .foto-boda img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 2px;
      display: block;
      filter: sepia(0.08) saturate(1.15) contrast(1.05);
      cursor: pointer;
      transition: filter 0.3s ease;
    }

    .foto-boda img:hover {
      filter: sepia(0.05) saturate(1.3) contrast(1.1) brightness(1.05);
    }

    .foto-boda-marco-dorado {
      position: absolute;
      top: -4px; left: -4px; right: -4px; bottom: -4px;
      border: 2px solid rgba(212, 175, 55, 0.4);
      border-radius: 5px;
      pointer-events: none;
      box-shadow: inset 0 0 10px rgba(255, 215, 0, 0.1);
    }

    .foto-boda-aparecer-1 { animation: foto-boda-in 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.3s forwards; }
    .foto-boda-aparecer-2 { animation: foto-boda-in 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 0.7s forwards; }
    .foto-boda-aparecer-3 { animation: foto-boda-in 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 1.1s forwards; }
    .foto-boda-aparecer-4 { animation: foto-boda-in 0.9s cubic-bezier(0.34, 1.56, 0.64, 1) 1.5s forwards; }

    @keyframes foto-boda-in {
      0% { opacity: 0; transform: translateY(60px) scale(0.6) rotateY(30deg); }
      100% { opacity: 1; transform: translateY(0) scale(1) rotateY(0deg); }
    }

    /* Particulas doradas de fondo */
    .particula-dorada {
      position: absolute;
      width: 3px;
      height: 3px;
      border-radius: 50%;
      background: #ffd700;
      box-shadow: 0 0 6px #ffd700, 0 0 15px rgba(255, 215, 0, 0.5);
      animation: particula-dorada-flotar 5s ease-in-out infinite;
      pointer-events: none;
    }

    @keyframes particula-dorada-flotar {
      0%, 100% { opacity: 0; transform: translateY(0) scale(0.5); }
      15% { opacity: 0.8; }
      85% { opacity: 0.8; }
      50% { transform: translateY(-80px) scale(1.3); }
      100% { opacity: 0; transform: translateY(-120px) scale(0.2); }
    }

    /* === Pantalla Patos === */
    .patos-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .patos-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    .patos-titulo {
      position: absolute;
      top: 8%;
      left: 50%;
      transform: translateX(-50%);
      color: #ffe0a0;
      font-size: clamp(1.2rem, 3.5vw, 2rem);
      text-align: center;
      text-shadow: 0 0 20px rgba(255, 200, 50, 0.6), 0 0 40px rgba(255, 150, 0, 0.3);
      z-index: 10;
      font-style: italic;
      opacity: 0;
      animation: patos-titulo-in 1s ease 0.5s forwards;
    }

    @keyframes patos-titulo-in {
      to { opacity: 1; }
    }

    /* Cofre 3D */
    .cofre-area {
      position: absolute;
      bottom: 18%;
      left: 50%;
      transform: translateX(-50%);
      width: 180px;
      height: 180px;
      z-index: 15;
      cursor: pointer;
    }

    .cofre-area canvas {
      width: 100%;
      height: 100%;
    }

    .cofre-hint {
      text-align: center;
      color: #ffd700;
      font-size: 0.9rem;
      margin-top: -5px;
      animation: pulse-hint 2s infinite;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    /* Texto Feliz San Valentin */
    .feliz-san-valentin {
      position: absolute;
      bottom: 6%;
      left: 50%;
      transform: translateX(-50%);
      color: #ff69b4;
      font-size: clamp(1.3rem, 4vw, 2.2rem);
      text-align: center;
      white-space: nowrap;
      text-shadow: 0 0 20px #ff1493, 0 0 40px #ff69b4, 0 0 60px #ff0066;
      z-index: 10;
      opacity: 0;
      pointer-events: none;
      animation: none;
    }

    .feliz-san-valentin.mostrar {
      animation: feliz-aparecer 1s ease forwards, pulse 2s ease-in-out 1s infinite;
    }

    @keyframes feliz-aparecer {
      0% { opacity: 0; transform: translateX(-50%) scale(0.5); }
      100% { opacity: 1; transform: translateX(-50%) scale(1); }
    }

    /* QR Overlay */
    .qr-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.9);
      z-index: 300;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(8px);
    }

    .qr-overlay.activo {
      display: flex;
    }

    .qr-card {
      background: linear-gradient(145deg, #2a1a2e, #1a0a1e);
      border: 2px solid rgba(255, 105, 180, 0.3);
      border-radius: 20px;
      padding: 30px;
      text-align: center;
      box-shadow: 0 0 60px rgba(255, 105, 180, 0.3);
      animation: qr-card-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    @keyframes qr-card-in {
      0% { transform: scale(0.3) rotateY(90deg); opacity: 0; }
      100% { transform: scale(1) rotateY(0); opacity: 1; }
    }

    .qr-titulo {
      color: #ff69b4;
      font-size: 1.5rem;
      margin-bottom: 15px;
      text-shadow: 0 0 15px #ff1493;
    }

    .qr-img {
      width: clamp(200px, 50vw, 300px);
      height: auto;
      border-radius: 10px;
      border: 3px solid rgba(255, 105, 180, 0.4);
      box-shadow: 0 0 30px rgba(255, 105, 180, 0.2);
    }

    .qr-sub {
      color: #ffd4e5;
      font-size: 1rem;
      margin-top: 12px;
      font-style: italic;
    }

    /* Fuegos artificiales */
    .fuego {
      position: absolute;
      pointer-events: none;
      z-index: 50;
    }

    .fuego-particula {
      position: absolute;
      width: 5px;
      height: 5px;
      border-radius: 50%;
      animation: fuego-explotar 1.5s ease-out forwards;
    }

    @keyframes fuego-explotar {
      0% { opacity: 1; transform: translate(0, 0) scale(1); }
      50% { opacity: 0.8; }
      100% { opacity: 0; transform: translate(var(--fx), var(--fy)) scale(0); }
    }

    .fuego-trail {
      position: absolute;
      width: 3px;
      border-radius: 2px;
      animation: fuego-subir 0.6s ease-out forwards;
    }

    @keyframes fuego-subir {
      0% { opacity: 1; height: 0; }
      50% { opacity: 1; }
      100% { opacity: 0; height: 80px; }
    }

    /* === Pantalla Final: Axolote === */
    .pantalla-final-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    /* Efecto de agua */
    .agua-fondo {
      position: absolute;
      bottom: 0;
      left: -10%;
      width: 120%;
      height: 35%;
      background: linear-gradient(180deg,
        transparent 0%,
        rgba(0, 180, 216, 0.05) 20%,
        rgba(0, 150, 199, 0.12) 50%,
        rgba(0, 119, 182, 0.2) 100%);
      pointer-events: none;
      z-index: 1;
    }

    .ola {
      position: absolute;
      left: -10%;
      width: 120%;
      height: 25px;
      background: transparent;
      pointer-events: none;
      z-index: 2;
    }

    .ola::before, .ola::after {
      content: '';
      position: absolute;
      width: 200%;
      height: 100%;
      top: 0;
      left: -50%;
      background: repeat-x;
    }

    .ola-1 {
      bottom: 32%;
      opacity: 0.4;
    }
    .ola-1::before {
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 20'%3E%3Cpath d='M0,10 Q25,0 50,10 T100,10 T150,10 T200,10 V20 H0 Z' fill='rgba(72,202,228,0.3)'/%3E%3C/svg%3E") repeat-x;
      background-size: 200px 20px;
      animation: ola-mover 4s linear infinite;
    }

    .ola-2 {
      bottom: 30%;
      opacity: 0.3;
    }
    .ola-2::before {
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 20'%3E%3Cpath d='M0,10 Q25,0 50,10 T100,10 T150,10 T200,10 V20 H0 Z' fill='rgba(0,150,199,0.25)'/%3E%3C/svg%3E") repeat-x;
      background-size: 180px 18px;
      animation: ola-mover 6s linear infinite reverse;
    }

    .ola-3 {
      bottom: 28%;
      opacity: 0.2;
    }
    .ola-3::before {
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 20'%3E%3Cpath d='M0,10 Q25,0 50,10 T100,10 T150,10 T200,10 V20 H0 Z' fill='rgba(0,119,182,0.2)'/%3E%3C/svg%3E") repeat-x;
      background-size: 220px 22px;
      animation: ola-mover 8s linear infinite;
    }

    @keyframes ola-mover {
      0% { transform: translateX(0); }
      100% { transform: translateX(50%); }
    }

    /* Burbujas de agua */
    .burbuja {
      position: absolute;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), rgba(72,202,228,0.15));
      border: 1px solid rgba(255,255,255,0.2);
      animation: burbuja-subir linear infinite;
      pointer-events: none;
      z-index: 3;
    }

    @keyframes burbuja-subir {
      0% { opacity: 0; transform: translateY(0) scale(0.5); }
      10% { opacity: 0.7; }
      90% { opacity: 0.5; }
      100% { opacity: 0; transform: translateY(-200px) scale(1.2); }
    }

    /* Orquideas flotantes estilo Mario Party */
    .orquidea-flotante {
      position: absolute;
      font-size: clamp(1.8rem, 4vw, 3rem);
      z-index: 4;
      pointer-events: none;
      filter: drop-shadow(0 3px 8px rgba(186, 85, 211, 0.5));
    }

    .orquidea-flotante.tipo-a {
      animation: mario-float-a var(--dur) ease-in-out infinite;
    }
    .orquidea-flotante.tipo-b {
      animation: mario-float-b var(--dur) ease-in-out infinite;
    }
    .orquidea-flotante.tipo-c {
      animation: mario-float-c var(--dur) ease-in-out infinite;
    }

    @keyframes mario-float-a {
      0% { transform: translate(0, 0) rotate(0deg) scale(1); }
      25% { transform: translate(15px, -25px) rotate(10deg) scale(1.1); }
      50% { transform: translate(-10px, -40px) rotate(-5deg) scale(0.95); }
      75% { transform: translate(20px, -15px) rotate(12deg) scale(1.08); }
      100% { transform: translate(0, 0) rotate(0deg) scale(1); }
    }

    @keyframes mario-float-b {
      0% { transform: translate(0, 0) rotate(0deg) scale(1); }
      25% { transform: translate(-20px, -15px) rotate(-12deg) scale(1.05); }
      50% { transform: translate(10px, -35px) rotate(8deg) scale(1.12); }
      75% { transform: translate(-15px, -20px) rotate(-6deg) scale(0.93); }
      100% { transform: translate(0, 0) rotate(0deg) scale(1); }
    }

    @keyframes mario-float-c {
      0% { transform: translate(0, 0) rotate(0deg) scale(1); }
      20% { transform: translate(12px, -30px) rotate(6deg) scale(1.08); }
      40% { transform: translate(-18px, -10px) rotate(-10deg) scale(0.97); }
      60% { transform: translate(8px, -45px) rotate(14deg) scale(1.15); }
      80% { transform: translate(-10px, -20px) rotate(-4deg) scale(1.02); }
      100% { transform: translate(0, 0) rotate(0deg) scale(1); }
    }

    /* Destello al hacer click */
    .destello {
      position: fixed;
      pointer-events: none;
      z-index: 100;
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .destello-particula {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: destello-explotar 0.8s ease-out forwards;
    }

    @keyframes destello-explotar {
      0% { opacity: 1; transform: translate(0, 0) scale(1); }
      100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(0); }
    }

    .destello-onda {
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      border: 2px solid rgba(255, 255, 255, 0.6);
      animation: destello-onda-expandir 0.6s ease-out forwards;
      transform: translate(-50%, -50%);
    }

    @keyframes destello-onda-expandir {
      0% { opacity: 1; width: 10px; height: 10px; }
      100% { opacity: 0; width: 120px; height: 120px; }
    }

    /* Axolote SVG */
    .axolote-container {
      position: relative;
      z-index: 10;
      animation: axolote-flotar 4s ease-in-out infinite;
      margin-bottom: 10px;
    }

    @keyframes axolote-flotar {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-15px); }
    }

    .axolote-container svg {
      width: clamp(180px, 35vw, 280px);
      height: auto;
      filter: drop-shadow(0 8px 25px rgba(255, 105, 180, 0.4));
    }

    /* Mensaje final largo */
    .mensaje-sanvalentin {
      color: #ffe0f0;
      font-size: clamp(0.85rem, 2.5vw, 1.3rem);
      text-align: center;
      max-width: 85%;
      line-height: 2;
      text-shadow: 0 0 20px #ff1493, 0 0 40px #ff69b4;
      padding: 15px 20px;
      background: radial-gradient(ellipse at center, rgba(255, 20, 147, 0.08) 0%, transparent 70%);
      border-radius: 20px;
      z-index: 10;
      position: relative;
      opacity: 0;
      animation: msg-final-in 1.5s ease 0.5s forwards;
    }

    @keyframes msg-final-in {
      0% { opacity: 0; transform: translateY(20px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    .toca-hint {
      position: absolute;
      bottom: 5%;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 212, 229, 0.5);
      font-size: 0.8rem;
      animation: pulse-hint 2s infinite;
      z-index: 10;
    }
  </style>
</head>
<body>
  <!-- Pantalla de Carga -->
  <div class="loading-screen" id="loadingScreen">
    <div class="pato-caminando">
      <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <!-- Cuerpo -->
        <ellipse cx="50" cy="55" rx="28" ry="22" fill="#ffdd33"/>
        <ellipse cx="50" cy="60" rx="22" ry="16" fill="#fff3c0"/>
        <!-- Cabeza -->
        <circle cx="50" cy="32" r="16" fill="#ffdd33"/>
        <!-- Ojo -->
        <circle cx="55" cy="29" r="4" fill="#222"/>
        <circle cx="57" cy="27" r="1.5" fill="white"/>
        <!-- Pico -->
        <ellipse cx="67" cy="35" rx="10" ry="4" fill="#ff8800"/>
        <!-- Mejilla -->
        <ellipse cx="43" cy="38" rx="5" ry="3" fill="rgba(255,120,150,0.4)"/>
        <!-- Ala -->
        <ellipse cx="35" cy="52" rx="10" ry="14" fill="#eebb22" transform="rotate(-15,35,52)"/>
        <!-- Pata izquierda -->
        <g class="loading-patas">
          <rect x="40" y="73" width="4" height="12" rx="2" fill="#ff8800"/>
          <ellipse cx="42" cy="86" rx="6" ry="3" fill="#ff8800"/>
        </g>
        <!-- Pata derecha -->
        <g class="loading-patas" style="animation-delay:0.15s;">
          <rect x="55" y="73" width="4" height="12" rx="2" fill="#ff8800"/>
          <ellipse cx="57" cy="86" rx="6" ry="3" fill="#ff8800"/>
        </g>
      </svg>
    </div>
    <p class="loading-texto" id="loadingTexto">Preparando algo especial...</p>
    <div class="loading-barra-fondo">
      <div class="loading-barra" id="loadingBarra"></div>
    </div>
    <div class="loading-huellas">
      <span class="huella">üêæ</span>
      <span class="huella">üêæ</span>
      <span class="huella">üêæ</span>
      <span class="huella">üêæ</span>
      <span class="huella">üêæ</span>
    </div>
  </div>

  <div id="escena-3d"></div>

  <!-- Pantalla 0: Sobre 3D -->
  <div class="pantalla" id="pantalla0" style="display:none;">
    <div class="corazon-flotante" style="left:15%; bottom:40%; animation-delay:0s;">üíó</div>
    <div class="corazon-flotante" style="right:18%; bottom:35%; animation-delay:1.2s;">üíï</div>
    <div class="corazon-flotante" style="left:25%; bottom:50%; animation-delay:2.4s;">üíñ</div>
    <div class="corazon-flotante" style="right:28%; bottom:45%; animation-delay:0.6s;">üíó</div>
    <div class="corazon-flotante" style="left:40%; bottom:38%; animation-delay:1.8s;">üíï</div>
    <div class="corazon-flotante" style="right:40%; bottom:52%; animation-delay:3s;">üíñ</div>

    <div class="sobre-3d-container" id="sobre3dContainer">
      <canvas id="sobreCanvas"></canvas>
      <span class="click-hint">toca para abrir</span>
    </div>
  </div>

  <!-- Pantalla 1: Mensaje -->
  <div class="pantalla" id="pantalla1">
    <div class="rosa-decorativa" style="top: 10%; left: 10%; animation-delay: 0s;">üåπ</div>
    <div class="rosa-decorativa" style="top: 20%; right: 15%; animation-delay: 1s;">üåπ</div>
    <div class="rosa-decorativa" style="bottom: 20%; left: 20%; animation-delay: 2s;">üåπ</div>
    <div class="rosa-decorativa" style="bottom: 30%; right: 10%; animation-delay: 0.5s;">üåπ</div>
    <div class="rosa-decorativa" style="top: 50%; left: 5%; animation-delay: 1.5s;">üå∏</div>
    <div class="rosa-decorativa" style="top: 40%; right: 5%; animation-delay: 2.5s;">üå∏</div>
    
    <p class="mensaje">
      No puedo dejar a mi esposa que no reciba flores este d√≠a.<br><br>
      Gracias por estar conmigo.<br>
      Tenemos una gran vida por delante<br>
      y gracias por acompa√±arme en estos momentos.
    </p>
    <button class="btn-siguiente" onclick="siguientePantalla()">Continuar ‚ù§Ô∏è</button>
  </div>

  <!-- Pantalla 2: Orquideas -->
  <div class="pantalla slide-right-enter" id="pantalla2" style="display:none;">
    <!-- Orquideas decorativas -->
    <div class="orquidea-decorativa" style="top: 5%; left: 8%; animation-delay: 0.2s, 0s;">üå∫</div>
    <div class="orquidea-decorativa" style="top: 12%; right: 12%; animation-delay: 0.6s, 1.2s;">üå∏</div>
    <div class="orquidea-decorativa" style="top: 35%; left: 5%; animation-delay: 1s, 0.5s;">üå∫</div>
    <div class="orquidea-decorativa" style="top: 25%; right: 6%; animation-delay: 0.4s, 2s;">üå∏</div>
    <div class="orquidea-decorativa" style="bottom: 25%; left: 10%; animation-delay: 1.4s, 1.5s;">üå∫</div>
    <div class="orquidea-decorativa" style="bottom: 15%; right: 8%; animation-delay: 0.8s, 0.8s;">üå∏</div>
    <div class="orquidea-decorativa" style="bottom: 35%; left: 3%; animation-delay: 1.8s, 2.5s;">üå∫</div>
    <div class="orquidea-decorativa" style="top: 8%; left: 45%; animation-delay: 1.2s, 1.8s;">üå∏</div>
    <div class="orquidea-decorativa" style="bottom: 8%; right: 40%; animation-delay: 2s, 0.3s;">üå∫</div>

    <!-- Brillos flotantes -->
    <div class="brillo-orquidea" style="top: 20%; left: 15%; animation-delay: 0s;"></div>
    <div class="brillo-orquidea" style="top: 40%; right: 20%; animation-delay: 1s;"></div>
    <div class="brillo-orquidea" style="bottom: 30%; left: 25%; animation-delay: 2s;"></div>
    <div class="brillo-orquidea" style="top: 60%; right: 30%; animation-delay: 0.5s;"></div>
    <div class="brillo-orquidea" style="bottom: 20%; left: 40%; animation-delay: 1.5s;"></div>
    <div class="brillo-orquidea" style="top: 15%; right: 35%; animation-delay: 2.5s;"></div>
    <div class="brillo-orquidea" style="bottom: 40%; right: 10%; animation-delay: 3s;"></div>
    <div class="brillo-orquidea" style="top: 50%; left: 8%; animation-delay: 3.5s;"></div>

    <!-- Lineas de luz -->
    <div class="linea-luz" style="left: 10%; bottom: 10%; animation-delay: 0s;"></div>
    <div class="linea-luz" style="right: 15%; bottom: 5%; animation-delay: 1s;"></div>
    <div class="linea-luz" style="left: 30%; bottom: 15%; animation-delay: 2s;"></div>
    <div class="linea-luz" style="right: 35%; bottom: 8%; animation-delay: 1.5s;"></div>
    <div class="linea-luz" style="left: 50%; bottom: 12%; animation-delay: 0.5s;"></div>
    <div class="linea-luz" style="right: 50%; bottom: 3%; animation-delay: 2.5s;"></div>

    <p class="mensaje-orquidea">
      Eres una mujer valiosa, una en un mill&oacute;n<br>
      y he sido el hombre m&aacute;s afortunado de la tierra<br>
      por haberte encontrado en estos momentos.
    </p>
    <button class="btn-siguiente" onclick="pantallaFinal()" style="background: linear-gradient(45deg, #9b30ff, #da70d6);">Continuar üíú</button>
  </div>

  <!-- Pantalla 3: Te amo -->
  <div class="pantalla" id="pantalla3" style="display:none;">
    <p class="mensaje-final">Te amo ‚ù§Ô∏è</p>
    <button class="btn-siguiente" onclick="pantallaPostales()">Continuar ‚ù§Ô∏è</button>
  </div>

  <!-- Pantalla 4: Postales / Fotos -->
  <div class="pantalla" id="pantalla4" style="display:none;">
    <div class="postales-container" id="postalesContainer">
      <!-- Postal 1 -->
      <div class="postal postal-1 postal-aparecer" data-parallax="1">
        <div class="postal-sello">üíï</div>
        <div class="postal-matasellos">14 FEB<br>2026</div>
        <img src="foto1.jpg" alt="Nosotros">
        <div class="postal-lineas">
          <span></span><span></span><span></span>
        </div>
        <div class="postal-texto">Con todo mi amor</div>
      </div>

      <!-- Postal 2 -->
      <div class="postal postal-2 postal-aparecer" data-parallax="2">
        <div class="postal-sello">üíñ</div>
        <div class="postal-matasellos">14 FEB<br>2026</div>
        <img src="foto2.jpg" alt="Nosotros">
        <div class="postal-lineas">
          <span></span><span></span><span></span>
        </div>
        <div class="postal-texto">Momentos juntos</div>
      </div>

      <!-- Postal 3 -->
      <div class="postal postal-3 postal-aparecer" data-parallax="3">
        <div class="postal-sello">üíó</div>
        <div class="postal-matasellos">14 FEB<br>2026</div>
        <img src="foto3.jpg" alt="Nosotros">
        <div class="postal-lineas">
          <span></span><span></span><span></span>
        </div>
        <div class="postal-texto">Por siempre</div>
      </div>

      <p class="titulo-postales">Nuestros momentos favoritos ‚ù§Ô∏è</p>
    </div>
    <button class="btn-siguiente" onclick="pantallaBoda()">Continuar ‚ù§Ô∏è</button>
  </div>

  <!-- Pantalla 5: Boda -->
  <div class="pantalla" id="pantalla5" style="display:none;">
    <div class="boda-container" id="bodaContainer">
      <!-- Particulas doradas -->
      <div class="particula-dorada" style="top:8%; left:12%; animation-delay:0s;"></div>
      <div class="particula-dorada" style="top:15%; right:18%; animation-delay:0.8s;"></div>
      <div class="particula-dorada" style="top:25%; left:25%; animation-delay:1.6s;"></div>
      <div class="particula-dorada" style="top:40%; right:8%; animation-delay:0.4s;"></div>
      <div class="particula-dorada" style="bottom:30%; left:8%; animation-delay:2s;"></div>
      <div class="particula-dorada" style="bottom:20%; right:22%; animation-delay:1.2s;"></div>
      <div class="particula-dorada" style="top:60%; left:5%; animation-delay:2.8s;"></div>
      <div class="particula-dorada" style="bottom:15%; left:35%; animation-delay:3.2s;"></div>
      <div class="particula-dorada" style="top:10%; left:50%; animation-delay:0.6s;"></div>
      <div class="particula-dorada" style="bottom:25%; right:5%; animation-delay:1.8s;"></div>
      <div class="particula-dorada" style="top:50%; right:15%; animation-delay:3.6s;"></div>
      <div class="particula-dorada" style="bottom:40%; left:18%; animation-delay:2.4s;"></div>

      <!-- Texto en arco -->
      <div class="texto-arco texto-arco-glow">
        <svg viewBox="0 0 700 150">
          <defs>
            <path id="arco" d="M 10,140 Q 350,-10 690,140" fill="none"/>
          </defs>
          <text>
            <textPath href="#arco" startOffset="50%" text-anchor="middle">
              Y el mejor regalo que alguien me haya podido dar
            </textPath>
          </text>
        </svg>
      </div>

      <!-- Fotos de boda -->
      <div class="fotos-boda-grid" id="fotosBodaGrid">
        <div class="foto-boda foto-boda-aparecer-1" data-parallax-boda="1">
          <div class="foto-boda-marco-dorado"></div>
          <img src="fotoboda1.jpg" alt="Nuestra boda">
        </div>
        <div class="foto-boda foto-boda-aparecer-2" data-parallax-boda="2">
          <div class="foto-boda-marco-dorado"></div>
          <img src="fotoboda2.jpg" alt="Nuestra boda">
        </div>
        <div class="foto-boda foto-boda-aparecer-3" data-parallax-boda="3">
          <div class="foto-boda-marco-dorado"></div>
          <img src="fotoboda3.jpg" alt="Nuestra boda">
        </div>
        <div class="foto-boda foto-boda-aparecer-4" data-parallax-boda="1.5">
          <div class="foto-boda-marco-dorado"></div>
          <img src="fotoboda4.png" alt="Nuestra boda">
        </div>
      </div>
    </div>
    <button class="btn-siguiente" onclick="pantallaAxolote()" style="background: linear-gradient(45deg, #d4af37, #f0d060); color:#5a3e1b;">Continuar üíç</button>
  </div>

  <!-- Pantalla 6: Axolote -->
  <div class="pantalla" id="pantalla6" style="display:none;">
    <div class="pantalla-final-container" id="pantallaFinalContainer">

      <!-- Efecto de agua -->
      <div class="agua-fondo"></div>
      <div class="ola ola-1"></div>
      <div class="ola ola-2"></div>
      <div class="ola ola-3"></div>

      <!-- Burbujas -->
      <div class="burbuja" style="width:8px;height:8px;bottom:5%;left:15%;animation-duration:4s;animation-delay:0s;"></div>
      <div class="burbuja" style="width:12px;height:12px;bottom:8%;left:35%;animation-duration:5s;animation-delay:1s;"></div>
      <div class="burbuja" style="width:6px;height:6px;bottom:3%;right:25%;animation-duration:3.5s;animation-delay:0.5s;"></div>
      <div class="burbuja" style="width:10px;height:10px;bottom:10%;right:40%;animation-duration:4.5s;animation-delay:2s;"></div>
      <div class="burbuja" style="width:7px;height:7px;bottom:6%;left:55%;animation-duration:3.8s;animation-delay:1.5s;"></div>
      <div class="burbuja" style="width:9px;height:9px;bottom:4%;right:15%;animation-duration:5.5s;animation-delay:0.8s;"></div>
      <div class="burbuja" style="width:5px;height:5px;bottom:12%;left:70%;animation-duration:3s;animation-delay:2.5s;"></div>
      <div class="burbuja" style="width:11px;height:11px;bottom:7%;left:45%;animation-duration:6s;animation-delay:3s;"></div>

      <!-- Orquideas flotantes Mario Party style -->
      <div class="orquidea-flotante tipo-a" style="top:3%;left:5%;--dur:4s;animation-delay:0s;">üå∫</div>
      <div class="orquidea-flotante tipo-b" style="top:8%;right:8%;--dur:5s;animation-delay:0.5s;">üå∏</div>
      <div class="orquidea-flotante tipo-c" style="top:20%;left:2%;--dur:4.5s;animation-delay:1s;">üå∫</div>
      <div class="orquidea-flotante tipo-a" style="top:15%;right:3%;--dur:3.8s;animation-delay:1.5s;">üå∏</div>
      <div class="orquidea-flotante tipo-b" style="top:35%;left:4%;--dur:5.2s;animation-delay:0.3s;">üå∫</div>
      <div class="orquidea-flotante tipo-c" style="top:45%;right:5%;--dur:4.2s;animation-delay:2s;">üå∏</div>
      <div class="orquidea-flotante tipo-a" style="bottom:38%;left:6%;--dur:3.5s;animation-delay:0.8s;">üå∫</div>
      <div class="orquidea-flotante tipo-b" style="bottom:42%;right:4%;--dur:4.8s;animation-delay:1.2s;">üå∏</div>
      <div class="orquidea-flotante tipo-c" style="top:5%;left:40%;--dur:5.5s;animation-delay:2.5s;">üå∫</div>
      <div class="orquidea-flotante tipo-a" style="top:28%;right:15%;--dur:4s;animation-delay:0.7s;">üå∏</div>
      <div class="orquidea-flotante tipo-b" style="top:55%;left:12%;--dur:3.7s;animation-delay:1.8s;">üå∫</div>
      <div class="orquidea-flotante tipo-c" style="top:10%;left:22%;--dur:4.3s;animation-delay:3s;">üå∏</div>
      <div class="orquidea-flotante tipo-a" style="top:42%;left:85%;--dur:5s;animation-delay:0.4s;">üå∫</div>
      <div class="orquidea-flotante tipo-b" style="top:60%;right:12%;--dur:3.9s;animation-delay:2.2s;">üå∏</div>

      <!-- Axolote SVG con canasta de flores -->
      <div class="axolote-container">
        <svg viewBox="0 0 300 320" xmlns="http://www.w3.org/2000/svg">
          <!-- Sombra -->
          <ellipse cx="150" cy="310" rx="70" ry="8" fill="rgba(0,0,0,0.1)"/>

          <!-- Cola -->
          <path d="M90,250 Q60,260 40,240 Q25,225 35,210 Q45,200 55,210 Q65,225 80,235" fill="#f8a4c8" stroke="#e8829f" stroke-width="1.5"/>
          <path d="M42,235 Q30,220 38,208" fill="none" stroke="rgba(255,150,180,0.4)" stroke-width="3" stroke-linecap="round"/>

          <!-- Cuerpo -->
          <ellipse cx="150" cy="230" rx="65" ry="55" fill="#ffb6d3"/>
          <ellipse cx="150" cy="230" rx="55" ry="45" fill="#ffc4dc"/>

          <!-- Panza -->
          <ellipse cx="150" cy="240" rx="35" ry="30" fill="#ffe0ee"/>

          <!-- Pata trasera izq -->
          <ellipse cx="105" cy="275" rx="18" ry="10" fill="#ffb6d3" transform="rotate(-10,105,275)"/>
          <!-- Pata trasera der -->
          <ellipse cx="195" cy="275" rx="18" ry="10" fill="#ffb6d3" transform="rotate(10,195,275)"/>

          <!-- Patas delanteras sosteniendo canasta -->
          <path d="M115,220 Q100,235 108,250" stroke="#ffb6d3" stroke-width="12" fill="none" stroke-linecap="round"/>
          <path d="M185,220 Q200,235 192,250" stroke="#ffb6d3" stroke-width="12" fill="none" stroke-linecap="round"/>

          <!-- Canasta de flores -->
          <path d="M108,248 Q110,270 150,275 Q190,270 192,248 Z" fill="#c68642" stroke="#a0682a" stroke-width="1.5"/>
          <path d="M112,253 Q150,258 188,253" fill="none" stroke="#a0682a" stroke-width="1"/>
          <path d="M114,260 Q150,265 186,260" fill="none" stroke="#a0682a" stroke-width="1"/>
          <!-- Patron tejido -->
          <line x1="130" y1="248" x2="135" y2="272" stroke="#a0682a" stroke-width="0.8" opacity="0.4"/>
          <line x1="150" y1="247" x2="150" y2="275" stroke="#a0682a" stroke-width="0.8" opacity="0.4"/>
          <line x1="170" y1="248" x2="165" y2="272" stroke="#a0682a" stroke-width="0.8" opacity="0.4"/>
          <!-- Asa de la canasta -->
          <path d="M118,248 Q150,220 182,248" fill="none" stroke="#a0682a" stroke-width="3" stroke-linecap="round"/>

          <!-- Flores en la canasta -->
          <circle cx="130" cy="242" r="10" fill="#ff69b4"/>
          <circle cx="130" cy="242" r="5" fill="#ffb6c1"/>
          <circle cx="150" cy="238" r="12" fill="#da70d6"/>
          <circle cx="150" cy="238" r="6" fill="#e8a0e0"/>
          <circle cx="170" cy="241" r="10" fill="#ff1493"/>
          <circle cx="170" cy="241" r="5" fill="#ff69b4"/>
          <circle cx="140" cy="235" r="8" fill="#ff6b8a"/>
          <circle cx="140" cy="235" r="4" fill="#ffb6c1"/>
          <circle cx="160" cy="234" r="9" fill="#ba55d3"/>
          <circle cx="160" cy="234" r="4.5" fill="#da90e8"/>
          <!-- Hojitas -->
          <ellipse cx="122" cy="245" rx="6" ry="3" fill="#4caf50" transform="rotate(-30,122,245)"/>
          <ellipse cx="178" cy="244" rx="6" ry="3" fill="#4caf50" transform="rotate(30,178,244)"/>
          <ellipse cx="145" cy="232" rx="5" ry="2.5" fill="#66bb6a" transform="rotate(-15,145,232)"/>

          <!-- Cabeza -->
          <ellipse cx="150" cy="160" rx="55" ry="50" fill="#ffb6d3"/>
          <ellipse cx="150" cy="165" rx="48" ry="42" fill="#ffc4dc"/>

          <!-- Branquias (rasgo de axolote!) -->
          <!-- Izquierda -->
          <path d="M95,135 Q70,110 60,90" stroke="#ff69b4" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M95,140 Q65,125 50,110" stroke="#ff69b4" stroke-width="4.5" fill="none" stroke-linecap="round"/>
          <path d="M98,148 Q70,145 55,135" stroke="#ff69b4" stroke-width="4" fill="none" stroke-linecap="round"/>
          <!-- Bolitas en puntas -->
          <circle cx="60" cy="90" r="5" fill="#ff1493"/>
          <circle cx="50" cy="110" r="4.5" fill="#ff1493"/>
          <circle cx="55" cy="135" r="4" fill="#ff1493"/>

          <!-- Derecha -->
          <path d="M205,135 Q230,110 240,90" stroke="#ff69b4" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M205,140 Q235,125 250,110" stroke="#ff69b4" stroke-width="4.5" fill="none" stroke-linecap="round"/>
          <path d="M202,148 Q230,145 245,135" stroke="#ff69b4" stroke-width="4" fill="none" stroke-linecap="round"/>
          <!-- Bolitas en puntas -->
          <circle cx="240" cy="90" r="5" fill="#ff1493"/>
          <circle cx="250" cy="110" r="4.5" fill="#ff1493"/>
          <circle cx="245" cy="135" r="4" fill="#ff1493"/>

          <!-- Ojos -->
          <ellipse cx="130" cy="155" rx="14" ry="15" fill="white"/>
          <ellipse cx="170" cy="155" rx="14" ry="15" fill="white"/>
          <circle cx="132" cy="157" r="8" fill="#2c2c2c"/>
          <circle cx="172" cy="157" r="8" fill="#2c2c2c"/>
          <!-- Brillo ojos -->
          <circle cx="136" cy="153" r="3.5" fill="white"/>
          <circle cx="176" cy="153" r="3.5" fill="white"/>
          <circle cx="130" cy="160" r="1.5" fill="white"/>
          <circle cx="170" cy="160" r="1.5" fill="white"/>

          <!-- Mejillas sonrojadas -->
          <ellipse cx="115" cy="175" rx="12" ry="7" fill="rgba(255,100,150,0.35)"/>
          <ellipse cx="185" cy="175" rx="12" ry="7" fill="rgba(255,100,150,0.35)"/>

          <!-- Sonrisa -->
          <path d="M138,178 Q150,192 162,178" fill="none" stroke="#d4567a" stroke-width="2.5" stroke-linecap="round"/>

          <!-- Naricita -->
          <ellipse cx="150" cy="170" rx="2.5" ry="2" fill="#e8829f"/>

          <!-- Corazoncito flotando -->
          <g transform="translate(200, 120)" opacity="0.8">
            <animateTransform attributeName="transform" type="translate" values="200,125; 200,115; 200,125" dur="2s" repeatCount="indefinite"/>
            <path d="M0,5 Q0,0 5,0 Q10,0 10,5 Q10,10 5,15 Q0,10 0,5 Z" fill="#ff1493" transform="scale(1.2)"/>
          </g>
        </svg>
      </div>

      <!-- Mensaje -->
      <p class="mensaje-sanvalentin">
        Feliz D&iacute;a de San Valent&iacute;n<br>
        a la mujer que convirti&oacute; mi caos en melod&iacute;a,<br>
        que sembr&oacute; primavera en mis inviernos<br>
        y que con solo mirarme<br>
        me ense&ntilde;&oacute; lo que significa eternidad,<br>
        que hace brillar mis ojos<br>
        y me recuerda lo bello que es la vida.
      </p>

      <span class="toca-hint">Toca para hacer magia ‚ú®</span>
    </div>
    <button class="btn-siguiente" onclick="pantallaPatos()" style="position:absolute; bottom:60px; z-index:20;">Continuar ‚ù§Ô∏è</button>
  </div>

  <!-- Pantalla 7: Patos 3D + Cofre -->
  <div class="pantalla" id="pantalla7" style="display:none;">
    <div class="patos-container" id="patosContainer">
      <canvas class="patos-canvas" id="patosCanvas"></canvas>
      <p class="patos-titulo">Ahora tendr&aacute;s una sorpresa muy especial üéÅ‚ú®</p>
      <div class="cofre-area" id="cofreArea">
        <canvas id="cofreCanvas"></canvas>
        <p class="cofre-hint">Toca el cofre üíù</p>
      </div>
      <p class="feliz-san-valentin" id="felizSV">
        üíï Feliz D&iacute;a de San Valent&iacute;n üíï
      </p>
      <div id="fuegosContainer"></div>
    </div>

    <!-- QR Overlay -->
    <div class="qr-overlay" id="qrOverlay">
      <div class="qr-card">
        <p class="qr-titulo">üíù Tu sorpresa üíù</p>
        <img src="qr.png" alt="QR Sorpresa" class="qr-img">
        <p class="qr-sub">Escanea el c&oacute;digo ‚ù§Ô∏è</p>
        <button class="btn-siguiente" onclick="cerrarQR()" style="margin-top:15px; padding:10px 30px; font-size:1rem;">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Overlay zoom fotos -->
  <div class="foto-zoom-overlay" id="fotoZoom" onclick="cerrarZoom()">
    <span class="foto-zoom-cerrar">&times;</span>
    <img id="fotoZoomImg" src="" alt="Zoom">
  </div>

  <div class="indicador-pestanas">
    <div class="punto activo" id="punto1"></div>
    <div class="punto" id="punto2"></div>
    <div class="punto" id="punto3"></div>
    <div class="punto" id="punto4"></div>
    <div class="punto" id="punto5"></div>
    <div class="punto" id="punto6"></div>
    <div class="punto" id="punto7"></div>
    <div class="punto" id="punto8"></div>
  </div>

  <script type="importmap">
  {
    "imports": {
      "three": "./three.module.js"
    }
  }
  </script>

  <script type="module">
    import * as THREE from 'three';

    let escena, camara, renderer, rosas = [], orquideas3D = [], brillos3D = [], tiempo = 0;

    function init() {
      escena = new THREE.Scene();
      camara = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camara.position.z = 6;

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      document.getElementById('escena-3d').appendChild(renderer.domElement);

      const luz1 = new THREE.PointLight(0xff1493, 3, 50);
      luz1.position.set(3, 3, 5);
      escena.add(luz1);

      const luz2 = new THREE.PointLight(0xff69b4, 2, 50);
      luz2.position.set(-3, -2, 3);
      escena.add(luz2);

      escena.add(new THREE.AmbientLight(0x2a0a1a, 0.8));

      crearRosas();
      crearParticulas();
      crearPetalos();
      crearOrquideas3D();
      crearBrillosOrquidea();

      window.addEventListener('resize', onResize);
      window.addEventListener('mousemove', onMouseMove);
    }

    function crearRosas() {
      const posiciones = [
        { x: -3, y: 2, z: -2 },
        { x: 3.5, y: 1.5, z: -3 },
        { x: -2.5, y: -1.5, z: -1 },
        { x: 2, y: -2, z: -2 },
        { x: 0, y: 2.5, z: -4 },
        { x: -1.5, y: -2.5, z: -3 },
        { x: 1.5, y: 2, z: -5 },
      ];

      posiciones.forEach((pos, i) => {
        const rosa = crearRosa();
        rosa.position.set(pos.x, pos.y, pos.z);
        rosa.rotation.y = Math.random() * Math.PI * 2;
        rosa.userData = { rotacionBase: rosa.rotation.y, delay: i * 0.5 };
        rosas.push(rosa);
        escena.add(rosa);
      });
    }

    function crearRosa() {
      const grupo = new THREE.Group();

      const geometriaTallo = new THREE.CylinderGeometry(0.02, 0.03, 1.5, 8);
      const materialTallo = new THREE.MeshPhongMaterial({ 
        color: 0x228b22,
        shininess: 30
      });
      const tallo = new THREE.Mesh(geometriaTallo, materialTallo);
      tallo.position.y = -0.5;
      grupo.add(tallo);

      const coloresPetalos = [0xff0066, 0xff1493, 0xff69b4, 0xcc1144];
      const colorPetalos = coloresPetalos[Math.floor(Math.random() * coloresPetalos.length)];

      for (let i = 0; i < 15; i++) {
        const escala = 0.15 + Math.random() * 0.1;
        const geometria = new THREE.SphereGeometry(escala, 16, 16);
        const material = new THREE.MeshPhongMaterial({
          color: colorPetalos,
          transparent: true,
          opacity: 0.85,
          shininess: 80,
          emissive: colorPetalos,
          emissiveIntensity: 0.1
        });
        const petalo = new THREE.Mesh(geometria, material);
        
        const angulo = (i / 15) * Math.PI * 2;
        const radio = 0.05 + Math.random() * 0.08;
        petalo.position.set(
          Math.cos(angulo) * radio,
          0.1 + Math.random() * 0.15,
          Math.sin(angulo) * radio
        );
        petalo.rotation.set(
          Math.random() * 0.5 - 0.25,
          Math.random() * 0.5 - 0.25,
          Math.random() * 0.5 - 0.25
        );
        grupo.add(petalo);
      }

      const centroGeo = new THREE.SphereGeometry(0.12, 16, 16);
      const centroMat = new THREE.MeshPhongMaterial({
        color: 0xff0044,
        transparent: true,
        opacity: 0.9,
        shininess: 100
      });
      const centro = new THREE.Mesh(centroGeo, centroMat);
      centro.position.y = 0.15;
      grupo.add(centro);

      for (let i = 0; i < 5; i++) {
        const hojaGeo = new THREE.PlaneGeometry(0.15, 0.25);
        const hojaMat = new THREE.MeshPhongMaterial({
          color: 0x228b22,
          transparent: true,
          opacity: 0.7,
          side: THREE.DoubleSide,
          shininess: 20
        });
        const hoja = new THREE.Mesh(hojaGeo, hojaMat);
        hoja.position.y = -0.3 - i * 0.2;
        hoja.rotation.y = i * 1.2;
        hoja.rotation.x = 0.3;
        grupo.add(hoja);
      }

      return grupo;
    }

    function crearPetalos() {
      const geometria = new THREE.BufferGeometry();
      const vertices = [];
      const colores = [];

      for (let i = 0; i < 200; i++) {
        vertices.push(
          (Math.random() - 0.5) * 15,
          (Math.random() - 0.5) * 15,
          (Math.random() - 0.5) * 10 - 5
        );
        
        const color = new THREE.Color();
        color.setHSL(0.95 + Math.random() * 0.05, 0.8, 0.6 + Math.random() * 0.3);
        colores.push(color.r, color.g, color.b);
      }

      geometria.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      geometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));

      const material = new THREE.PointsMaterial({
        size: 0.08,
        vertexColors: true,
        transparent: true,
        opacity: 0.7,
        blending: THREE.AdditiveBlending
      });

      const petalos = new THREE.Points(geometria, material);
      petalos.userData = { tipo: 'petalos' };
      escena.add(petalos);
    }

    function crearParticulas() {
      const geometria = new THREE.BufferGeometry();
      const vertices = [];

      for (let i = 0; i < 300; i++) {
        vertices.push(
          (Math.random() - 0.5) * 20,
          (Math.random() - 0.5) * 20,
          (Math.random() - 0.5) * 20
        );
      }

      geometria.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      const material = new THREE.PointsMaterial({
        color: 0xffb6c1,
        size: 0.03,
        transparent: true,
        opacity: 0.6
      });
      const particulas = new THREE.Points(geometria, material);
      particulas.userData = { tipo: 'particulas' };
      escena.add(particulas);
    }

    function crearOrquideas3D() {
      const posiciones = [
        { x: -4, y: 2.5, z: -3 },
        { x: 4, y: 2, z: -4 },
        { x: -3, y: -1.5, z: -2 },
        { x: 3.5, y: -2, z: -3 },
        { x: 0, y: 3, z: -5 },
        { x: -2, y: -3, z: -4 },
        { x: 2.5, y: 0, z: -6 },
        { x: -1, y: 1, z: -3 },
      ];

      posiciones.forEach((pos, i) => {
        const orquidea = crearOrquidea3D();
        orquidea.position.set(pos.x, pos.y, pos.z);
        orquidea.rotation.y = Math.random() * Math.PI * 2;
        orquidea.userData = { rotacionBase: orquidea.rotation.y, delay: i * 0.7, tipo: 'orquidea' };
        orquidea.visible = false;
        orquideas3D.push(orquidea);
        escena.add(orquidea);
      });
    }

    function crearOrquidea3D() {
      const grupo = new THREE.Group();

      // Tallo curvo
      const curva = new THREE.CubicBezierCurve3(
        new THREE.Vector3(0, -0.8, 0),
        new THREE.Vector3(0.1, -0.4, 0.05),
        new THREE.Vector3(-0.1, 0, -0.05),
        new THREE.Vector3(0, 0.3, 0)
      );
      const geometriaTallo = new THREE.TubeGeometry(curva, 20, 0.02, 8, false);
      const materialTallo = new THREE.MeshPhongMaterial({
        color: 0x2d5a27,
        shininess: 40
      });
      grupo.add(new THREE.Mesh(geometriaTallo, materialTallo));

      // Petalos de orquidea (forma caracteristica)
      const coloresOrquidea = [0xda70d6, 0xba55d3, 0x9b30ff, 0xcc44ff, 0xe088e0];
      const colorBase = coloresOrquidea[Math.floor(Math.random() * coloresOrquidea.length)];

      // 3 petalos superiores (sepalos)
      for (let i = 0; i < 3; i++) {
        const angulo = (i / 3) * Math.PI * 2 - Math.PI / 2;
        const geometria = new THREE.SphereGeometry(0.18, 16, 16);
        geometria.scale(1, 0.3, 0.6);
        const material = new THREE.MeshPhongMaterial({
          color: colorBase,
          transparent: true,
          opacity: 0.85,
          shininess: 100,
          emissive: colorBase,
          emissiveIntensity: 0.15
        });
        const petalo = new THREE.Mesh(geometria, material);
        petalo.position.set(
          Math.cos(angulo) * 0.15,
          0.35 + Math.sin(angulo) * 0.12,
          0
        );
        petalo.rotation.z = angulo;
        grupo.add(petalo);
      }

      // 2 petalos laterales mas grandes
      for (let i = 0; i < 2; i++) {
        const lado = i === 0 ? -1 : 1;
        const geometria = new THREE.SphereGeometry(0.22, 16, 16);
        geometria.scale(0.8, 0.35, 0.5);
        const material = new THREE.MeshPhongMaterial({
          color: colorBase,
          transparent: true,
          opacity: 0.9,
          shininess: 120,
          emissive: colorBase,
          emissiveIntensity: 0.2
        });
        const petalo = new THREE.Mesh(geometria, material);
        petalo.position.set(lado * 0.2, 0.3, 0.05);
        petalo.rotation.z = lado * 0.4;
        grupo.add(petalo);
      }

      // Labelo (petalo central inferior, caracteristico de las orquideas)
      const geometriaLabelo = new THREE.SphereGeometry(0.14, 16, 16);
      geometriaLabelo.scale(1.2, 0.8, 0.6);
      const materialLabelo = new THREE.MeshPhongMaterial({
        color: 0xff66cc,
        transparent: true,
        opacity: 0.9,
        shininess: 100,
        emissive: 0xff44aa,
        emissiveIntensity: 0.25
      });
      const labelo = new THREE.Mesh(geometriaLabelo, materialLabelo);
      labelo.position.set(0, 0.2, 0.1);
      grupo.add(labelo);

      // Centro (columna)
      const geometriaCentro = new THREE.SphereGeometry(0.06, 12, 12);
      const materialCentro = new THREE.MeshPhongMaterial({
        color: 0xffdd00,
        shininess: 150,
        emissive: 0xffaa00,
        emissiveIntensity: 0.3
      });
      const centro = new THREE.Mesh(geometriaCentro, materialCentro);
      centro.position.set(0, 0.32, 0.08);
      grupo.add(centro);

      // Hojas largas
      for (let i = 0; i < 3; i++) {
        const hojaGeo = new THREE.PlaneGeometry(0.12, 0.4);
        const hojaMat = new THREE.MeshPhongMaterial({
          color: 0x2d5a27,
          transparent: true,
          opacity: 0.75,
          side: THREE.DoubleSide,
          shininess: 30
        });
        const hoja = new THREE.Mesh(hojaGeo, hojaMat);
        hoja.position.y = -0.5 - i * 0.15;
        hoja.rotation.y = i * 1.5;
        hoja.rotation.x = 0.2 + i * 0.1;
        grupo.add(hoja);
      }

      return grupo;
    }

    function crearBrillosOrquidea() {
      const geometria = new THREE.BufferGeometry();
      const vertices = [];
      const colores = [];

      for (let i = 0; i < 250; i++) {
        vertices.push(
          (Math.random() - 0.5) * 16,
          (Math.random() - 0.5) * 16,
          (Math.random() - 0.5) * 12 - 4
        );
        const color = new THREE.Color();
        color.setHSL(0.78 + Math.random() * 0.1, 0.7, 0.5 + Math.random() * 0.4);
        colores.push(color.r, color.g, color.b);
      }

      geometria.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      geometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));

      const material = new THREE.PointsMaterial({
        size: 0.06,
        vertexColors: true,
        transparent: true,
        opacity: 0,
        blending: THREE.AdditiveBlending
      });

      const brillos = new THREE.Points(geometria, material);
      brillos.userData = { tipo: 'brillos-orquidea' };
      brillos3D.push(brillos);
      escena.add(brillos);
    }

    let mouseX = 0, mouseY = 0;

    function onMouseMove(event) {
      mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
    }

    function animate() {
      requestAnimationFrame(animate);
      tiempo += 0.008;

      camara.position.x += (mouseX * 0.5 - camara.position.x) * 0.02;
      camara.position.y += (mouseY * 0.3 - camara.position.y) * 0.02;
      camara.lookAt(escena.position);

      rosas.forEach((rosa, i) => {
        rosa.rotation.y = rosa.userData.rotacionBase + Math.sin(tiempo + rosa.userData.delay) * 0.3;
        rosa.position.y += Math.sin(tiempo * 2 + i) * 0.001;
      });

      // Animar orquideas 3D
      orquideas3D.forEach((orq, i) => {
        if (orq.visible) {
          orq.rotation.y = orq.userData.rotacionBase + Math.sin(tiempo * 0.8 + orq.userData.delay) * 0.4;
          orq.position.y += Math.sin(tiempo * 1.5 + i * 0.8) * 0.0008;
          orq.position.x += Math.cos(tiempo * 0.7 + i * 1.2) * 0.0003;
        }
      });

      escena.children.forEach(child => {
        if (child.userData.tipo === 'petalos') {
          child.rotation.y += 0.0005;
          child.rotation.x = Math.sin(tiempo * 0.5) * 0.1;
        }
        if (child.userData.tipo === 'particulas') {
          child.rotation.y += 0.001;
        }
        if (child.userData.tipo === 'brillos-orquidea') {
          child.rotation.y += 0.0008;
          child.rotation.x = Math.sin(tiempo * 0.3) * 0.15;
          child.rotation.z = Math.cos(tiempo * 0.4) * 0.1;
        }
      });

      renderer.render(escena, camara);
    }

    function onResize() {
      camara.aspect = window.innerWidth / window.innerHeight;
      camara.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    init();
    animate();

    window.abrirCarta = function() {
      const envelope = document.getElementById('envelope');
      envelope.classList.add('open');
      
      setTimeout(() => {
        const p0 = document.getElementById('pantalla0');
        const p1 = document.getElementById('pantalla1');
        
        p0.classList.remove('visible');
        p0.classList.add('oculta');
        
        setTimeout(() => {
          p0.style.display = 'none';
          p1.style.display = 'flex';
          
          setTimeout(() => {
            p1.classList.add('visible');
            document.getElementById('punto1').classList.remove('activo');
            document.getElementById('punto2').classList.add('activo');
          }, 100);
        }, 300);
      }, 1200);
    };

    window.siguientePantalla = function() {
      const p1 = document.getElementById('pantalla1');
      const p2 = document.getElementById('pantalla2');

      p1.classList.remove('visible');
      p1.classList.add('oculta');

      // Ocultar rosas 3D, mostrar orquideas 3D
      rosas.forEach(r => { r.visible = false; });
      orquideas3D.forEach(o => { o.visible = true; });
      brillos3D.forEach(b => { b.material.opacity = 0.7; });

      // Cambiar luces a tonos purpura
      escena.children.forEach(child => {
        if (child.isPointLight) {
          child.color.setHex(0x9b30ff);
        }
      });

      setTimeout(() => {
        p1.style.display = 'none';
        p2.style.display = 'flex';

        setTimeout(() => {
          p2.classList.remove('slide-right-enter');
          p2.classList.add('slide-right-visible');
          document.getElementById('punto2').classList.remove('activo');
          document.getElementById('punto3').classList.add('activo');
        }, 50);
      }, 500);
    };

    window.pantallaFinal = function() {
      const p2 = document.getElementById('pantalla2');
      const p3 = document.getElementById('pantalla3');

      p2.classList.remove('slide-right-visible');
      p2.classList.add('slide-right-exit');

      setTimeout(() => {
        p2.style.display = 'none';
        p3.style.display = 'flex';

        setTimeout(() => {
          p3.classList.add('visible');
          document.getElementById('punto3').classList.remove('activo');
          document.getElementById('punto4').classList.add('activo');
        }, 100);
      }, 500);
    };

    window.pantallaPostales = function() {
      const p3 = document.getElementById('pantalla3');
      const p4 = document.getElementById('pantalla4');

      p3.classList.remove('visible');
      p3.classList.add('oculta');

      setTimeout(() => {
        p3.style.display = 'none';
        p4.style.display = 'flex';

        setTimeout(() => {
          p4.classList.add('visible');
          document.getElementById('punto4').classList.remove('activo');
          document.getElementById('punto5').classList.add('activo');
          iniciarParallaxPostales();
        }, 100);
      }, 500);
    };

    window.pantallaBoda = function() {
      const p4 = document.getElementById('pantalla4');
      const p5 = document.getElementById('pantalla5');

      p4.classList.remove('visible');
      p4.classList.add('oculta');

      setTimeout(() => {
        p4.style.display = 'none';
        p5.style.display = 'flex';

        setTimeout(() => {
          p5.classList.add('visible');
          document.getElementById('punto5').classList.remove('activo');
          document.getElementById('punto6').classList.add('activo');
          iniciarParallaxBoda();
        }, 100);
      }, 500);
    };

    window.pantallaAxolote = function() {
      const p5 = document.getElementById('pantalla5');
      const p6 = document.getElementById('pantalla6');

      p5.classList.remove('visible');
      p5.classList.add('oculta');

      // Cambiar luces a tonos rosa/agua
      escena.children.forEach(child => {
        if (child.isPointLight) {
          child.color.setHex(0xff69b4);
        }
      });

      setTimeout(() => {
        p5.style.display = 'none';
        p6.style.display = 'flex';

        setTimeout(() => {
          p6.classList.add('visible');
          document.getElementById('punto6').classList.remove('activo');
          document.getElementById('punto7').classList.add('activo');
          iniciarDestellos();
        }, 100);
      }, 500);
    };

    window.pantallaPatos = function() {
      const p6 = document.getElementById('pantalla6');
      const p7 = document.getElementById('pantalla7');

      p6.classList.remove('visible');
      p6.classList.add('oculta');

      setTimeout(() => {
        p6.style.display = 'none';
        p7.style.display = 'flex';

        setTimeout(() => {
          p7.classList.add('visible');
          document.getElementById('punto7').classList.remove('activo');
          document.getElementById('punto8').classList.add('activo');
          iniciarEscenaPatos();
          iniciarCofre();
        }, 100);
      }, 500);
    };

    // Escena de patos 3D
    let escenaPatos, camaraPatos, rendererPatos, patos3D = [], tiempoPatos = 0;
    let patosMouseX = 0, patosMouseY = 0;

    function iniciarEscenaPatos() {
      const canvas = document.getElementById('patosCanvas');
      const container = document.getElementById('patosContainer');

      escenaPatos = new THREE.Scene();
      escenaPatos.fog = new THREE.FogExp2(0x1a2a3a, 0.04);

      camaraPatos = new THREE.PerspectiveCamera(60, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
      camaraPatos.position.set(0, 8, 14);
      camaraPatos.lookAt(0, 0, 0);

      rendererPatos = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
      rendererPatos.setSize(canvas.clientWidth, canvas.clientHeight);
      rendererPatos.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // Luces
      const luzAmb = new THREE.AmbientLight(0x6688aa, 0.8);
      escenaPatos.add(luzAmb);

      const luzSol = new THREE.DirectionalLight(0xffeedd, 1.2);
      luzSol.position.set(5, 10, 5);
      escenaPatos.add(luzSol);

      const luzRosa = new THREE.PointLight(0xff69b4, 0.6, 30);
      luzRosa.position.set(-5, 5, 3);
      escenaPatos.add(luzRosa);

      // Agua (plano grande)
      const aguaGeo = new THREE.PlaneGeometry(40, 40, 60, 60);
      const aguaMat = new THREE.MeshPhongMaterial({
        color: 0x2288aa,
        transparent: true,
        opacity: 0.75,
        shininess: 100,
        emissive: 0x0a3344,
        emissiveIntensity: 0.3,
        side: THREE.DoubleSide
      });
      const agua = new THREE.Mesh(aguaGeo, aguaMat);
      agua.rotation.x = -Math.PI / 2;
      agua.position.y = -0.5;
      agua.userData = { tipo: 'agua', posicionesOrig: [] };
      const posArr = aguaGeo.attributes.position.array;
      for (let i = 0; i < posArr.length; i++) {
        agua.userData.posicionesOrig.push(posArr[i]);
      }
      escenaPatos.add(agua);

      // Lirios / plantas flotantes
      for (let i = 0; i < 12; i++) {
        const ang = Math.random() * Math.PI * 2;
        const dist = 4 + Math.random() * 10;
        const lirioGrp = new THREE.Group();

        // Hoja de lirio (disco plano)
        const hojaGeo = new THREE.CircleGeometry(0.4 + Math.random() * 0.3, 12);
        const hojaMat = new THREE.MeshPhongMaterial({
          color: 0x22aa44,
          transparent: true,
          opacity: 0.8,
          side: THREE.DoubleSide
        });
        const hoja = new THREE.Mesh(hojaGeo, hojaMat);
        hoja.rotation.x = -Math.PI / 2;
        lirioGrp.add(hoja);

        // Flor sobre el lirio (algunos)
        if (Math.random() > 0.5) {
          const florGeo = new THREE.SphereGeometry(0.15, 8, 8);
          const florMat = new THREE.MeshPhongMaterial({
            color: [0xff69b4, 0xffffff, 0xffdd44, 0xff1493][Math.floor(Math.random() * 4)],
            emissive: 0xff69b4,
            emissiveIntensity: 0.1
          });
          const flor = new THREE.Mesh(florGeo, florMat);
          flor.position.y = 0.1;
          lirioGrp.add(flor);
        }

        lirioGrp.position.set(Math.cos(ang) * dist, -0.3, Math.sin(ang) * dist);
        lirioGrp.userData = { tipo: 'lirio', angBase: ang, dist: dist };
        escenaPatos.add(lirioGrp);
      }

      // Crear patos
      const numPatos = 6;
      for (let i = 0; i < numPatos; i++) {
        const pato = crearPato3D();
        const angulo = (i / numPatos) * Math.PI * 2;
        const radio = 3 + Math.random() * 3;
        pato.userData = {
          angulo: angulo,
          radio: radio,
          velocidad: 0.15 + Math.random() * 0.15,
          bobDelay: Math.random() * Math.PI * 2,
          direccion: Math.random() > 0.5 ? 1 : -1
        };
        patos3D.push(pato);
        escenaPatos.add(pato);
      }

      // Parallax
      container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        patosMouseX = ((e.clientX - rect.left) / rect.width - 0.5) * 2;
        patosMouseY = ((e.clientY - rect.top) / rect.height - 0.5) * 2;
      });

      container.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const rect = container.getBoundingClientRect();
        patosMouseX = ((touch.clientX - rect.left) / rect.width - 0.5) * 2;
        patosMouseY = ((touch.clientY - rect.top) / rect.height - 0.5) * 2;
      });

      animarPatos();

      window.addEventListener('resize', () => {
        if (rendererPatos && canvas.clientWidth > 0) {
          camaraPatos.aspect = canvas.clientWidth / canvas.clientHeight;
          camaraPatos.updateProjectionMatrix();
          rendererPatos.setSize(canvas.clientWidth, canvas.clientHeight);
        }
      });
    }

    function crearPato3D() {
      const grupo = new THREE.Group();

      // Cuerpo
      const cuerpoGeo = new THREE.SphereGeometry(0.6, 16, 12);
      cuerpoGeo.scale(1.3, 0.8, 0.9);
      const cuerpoMat = new THREE.MeshPhongMaterial({
        color: 0xffdd33,
        shininess: 60,
        emissive: 0xaa8800,
        emissiveIntensity: 0.1
      });
      const cuerpo = new THREE.Mesh(cuerpoGeo, cuerpoMat);
      grupo.add(cuerpo);

      // Pecho blanco
      const pechoGeo = new THREE.SphereGeometry(0.45, 12, 10);
      pechoGeo.scale(1, 0.7, 0.8);
      const pechoMat = new THREE.MeshPhongMaterial({ color: 0xfff8e0, shininess: 40 });
      const pecho = new THREE.Mesh(pechoGeo, pechoMat);
      pecho.position.set(0, -0.1, 0.15);
      grupo.add(pecho);

      // Cabeza
      const cabezaGeo = new THREE.SphereGeometry(0.38, 14, 12);
      const cabezaMat = new THREE.MeshPhongMaterial({
        color: 0xffdd33,
        shininess: 80,
        emissive: 0xaa8800,
        emissiveIntensity: 0.05
      });
      const cabeza = new THREE.Mesh(cabezaGeo, cabezaMat);
      cabeza.position.set(0, 0.55, 0.3);
      grupo.add(cabeza);

      // Ojos
      for (let side = -1; side <= 1; side += 2) {
        const ojoGeo = new THREE.SphereGeometry(0.07, 8, 8);
        const ojoMat = new THREE.MeshPhongMaterial({ color: 0x111111, shininess: 120 });
        const ojo = new THREE.Mesh(ojoGeo, ojoMat);
        ojo.position.set(side * 0.18, 0.62, 0.55);
        grupo.add(ojo);

        // Brillo del ojo
        const brilloGeo = new THREE.SphereGeometry(0.025, 6, 6);
        const brilloMat = new THREE.MeshBasicMaterial({ color: 0xffffff });
        const brillo = new THREE.Mesh(brilloGeo, brilloMat);
        brillo.position.set(side * 0.16, 0.65, 0.58);
        grupo.add(brillo);
      }

      // Pico
      const picoGeo = new THREE.ConeGeometry(0.12, 0.3, 8);
      picoGeo.scale(1, 1, 0.5);
      const picoMat = new THREE.MeshPhongMaterial({ color: 0xff8800, shininess: 40 });
      const pico = new THREE.Mesh(picoGeo, picoMat);
      pico.position.set(0, 0.48, 0.62);
      pico.rotation.x = Math.PI / 2;
      grupo.add(pico);

      // Cola
      const colaGeo = new THREE.ConeGeometry(0.2, 0.4, 6);
      const colaMat = new THREE.MeshPhongMaterial({ color: 0xeecc22 });
      const cola = new THREE.Mesh(colaGeo, colaMat);
      cola.position.set(0, 0.2, -0.7);
      cola.rotation.x = -0.6;
      grupo.add(cola);

      // Alas
      for (let side = -1; side <= 1; side += 2) {
        const alaGeo = new THREE.SphereGeometry(0.3, 8, 8);
        alaGeo.scale(0.4, 0.7, 1);
        const alaMat = new THREE.MeshPhongMaterial({
          color: 0xeebb22,
          shininess: 30
        });
        const ala = new THREE.Mesh(alaGeo, alaMat);
        ala.position.set(side * 0.55, 0.1, -0.1);
        ala.rotation.z = side * 0.3;
        grupo.add(ala);
      }

      // Mejillas rosadas
      for (let side = -1; side <= 1; side += 2) {
        const mejGeo = new THREE.SphereGeometry(0.08, 8, 8);
        const mejMat = new THREE.MeshPhongMaterial({
          color: 0xff8899,
          transparent: true,
          opacity: 0.5
        });
        const mej = new THREE.Mesh(mejGeo, mejMat);
        mej.position.set(side * 0.28, 0.48, 0.5);
        grupo.add(mej);
      }

      return grupo;
    }

    function animarPatos() {
      requestAnimationFrame(animarPatos);
      tiempoPatos += 0.01;

      // Parallax camara
      camaraPatos.position.x += (patosMouseX * 4 - camaraPatos.position.x) * 0.03;
      camaraPatos.position.y += (8 - patosMouseY * 2 - camaraPatos.position.y) * 0.03;
      camaraPatos.lookAt(0, 0, 0);

      // Animar agua
      escenaPatos.children.forEach(child => {
        if (child.userData.tipo === 'agua') {
          const pos = child.geometry.attributes.position;
          const orig = child.userData.posicionesOrig;
          for (let i = 0; i < pos.count; i++) {
            const ox = orig[i * 3];
            const oy = orig[i * 3 + 1];
            pos.array[i * 3 + 2] = Math.sin(ox * 0.5 + tiempoPatos * 2) * 0.15 +
                                     Math.cos(oy * 0.3 + tiempoPatos * 1.5) * 0.1;
          }
          pos.needsUpdate = true;
        }

        // Lirios flotan suavemente
        if (child.userData.tipo === 'lirio') {
          child.position.y = -0.3 + Math.sin(tiempoPatos * 1.5 + child.userData.angBase) * 0.05;
          child.rotation.z = Math.sin(tiempoPatos + child.userData.angBase) * 0.05;
        }
      });

      // Patos nadan en circulos
      patos3D.forEach((pato) => {
        const ud = pato.userData;
        ud.angulo += ud.velocidad * 0.01 * ud.direccion;
        const x = Math.cos(ud.angulo) * ud.radio;
        const z = Math.sin(ud.angulo) * ud.radio;

        pato.position.x = x;
        pato.position.z = z;
        pato.position.y = Math.sin(tiempoPatos * 2 + ud.bobDelay) * 0.08;

        // El pato mira en la direccion que nada
        const siguienteAng = ud.angulo + 0.05 * ud.direccion;
        const lookX = Math.cos(siguienteAng) * ud.radio;
        const lookZ = Math.sin(siguienteAng) * ud.radio;
        pato.lookAt(lookX, pato.position.y, lookZ);

        // Balanceo suave
        pato.rotation.z = Math.sin(tiempoPatos * 3 + ud.bobDelay) * 0.05;
      });

      rendererPatos.render(escenaPatos, camaraPatos);
    }

    // Cofre 3D
    let escenaCofre, camaraCofre, rendererCofre, cofreGrupo, cofreAbierto = false;

    function iniciarCofre() {
      const canvas = document.getElementById('cofreCanvas');

      escenaCofre = new THREE.Scene();
      camaraCofre = new THREE.PerspectiveCamera(50, 1, 0.1, 100);
      camaraCofre.position.set(0, 1.5, 4);
      camaraCofre.lookAt(0, 0.3, 0);

      rendererCofre = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
      rendererCofre.setSize(180, 180);
      rendererCofre.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      // Luces
      escenaCofre.add(new THREE.AmbientLight(0xffffff, 0.5));
      const luzDir = new THREE.DirectionalLight(0xffeedd, 1);
      luzDir.position.set(2, 3, 2);
      escenaCofre.add(luzDir);
      const luzDorada = new THREE.PointLight(0xffd700, 1.5, 10);
      luzDorada.position.set(0, 2, 2);
      escenaCofre.add(luzDorada);

      cofreGrupo = new THREE.Group();

      // Base del cofre
      const baseGeo = new THREE.BoxGeometry(1.6, 0.8, 1);
      const baseMat = new THREE.MeshPhongMaterial({
        color: 0x8B4513,
        shininess: 60,
        emissive: 0x3a1a05,
        emissiveIntensity: 0.15
      });
      const base = new THREE.Mesh(baseGeo, baseMat);
      base.position.y = 0.4;
      cofreGrupo.add(base);

      // Bandas metalicas horizontales
      for (let i = -1; i <= 1; i++) {
        const bandaGeo = new THREE.BoxGeometry(1.65, 0.06, 1.05);
        const bandaMat = new THREE.MeshPhongMaterial({
          color: 0xDAA520,
          shininess: 120,
          emissive: 0x886600,
          emissiveIntensity: 0.2
        });
        const banda = new THREE.Mesh(bandaGeo, bandaMat);
        banda.position.set(0, 0.2 + i * 0.25, 0);
        cofreGrupo.add(banda);
      }

      // Cerradura
      const cerraduraGeo = new THREE.BoxGeometry(0.2, 0.25, 0.1);
      const cerraduraMat = new THREE.MeshPhongMaterial({
        color: 0xFFD700,
        shininess: 150,
        emissive: 0xaa8800,
        emissiveIntensity: 0.3
      });
      const cerradura = new THREE.Mesh(cerraduraGeo, cerraduraMat);
      cerradura.position.set(0, 0.35, 0.53);
      cofreGrupo.add(cerradura);

      // Ojo de cerradura
      const ojoGeo = new THREE.CircleGeometry(0.04, 8);
      const ojoMat = new THREE.MeshBasicMaterial({ color: 0x111111 });
      const ojo = new THREE.Mesh(ojoGeo, ojoMat);
      ojo.position.set(0, 0.37, 0.59);
      cofreGrupo.add(ojo);

      // Tapa (se abrira)
      const tapaGrupo = new THREE.Group();
      tapaGrupo.position.set(0, 0.8, -0.5);

      const tapaGeo = new THREE.BoxGeometry(1.6, 0.15, 1);
      const tapaMesh = new THREE.Mesh(tapaGeo, baseMat.clone());
      tapaMesh.position.set(0, 0.075, 0.5);
      tapaGrupo.add(tapaMesh);

      // Tapa curva (arco superior)
      const arcoGeo = new THREE.CylinderGeometry(0.5, 0.5, 1.6, 16, 1, false, 0, Math.PI);
      const arcoMesh = new THREE.Mesh(arcoGeo, baseMat.clone());
      arcoMesh.rotation.z = Math.PI / 2;
      arcoMesh.position.set(0, 0.15, 0.5);
      tapaGrupo.add(arcoMesh);

      // Banda metalica en la tapa
      const bandaTapaGeo = new THREE.BoxGeometry(1.65, 0.06, 1.05);
      const bandaTapa = new THREE.Mesh(bandaTapaGeo, new THREE.MeshPhongMaterial({
        color: 0xDAA520, shininess: 120, emissive: 0x886600, emissiveIntensity: 0.2
      }));
      bandaTapa.position.set(0, 0.075, 0.5);
      tapaGrupo.add(bandaTapa);

      cofreGrupo.add(tapaGrupo);
      cofreGrupo.userData.tapa = tapaGrupo;
      cofreGrupo.userData.tapaAng = 0;

      // Brillo interior (se ve al abrir)
      const brilloGeo = new THREE.PointLight(0xffd700, 0, 5);
      brilloGeo.position.set(0, 0.6, 0);
      cofreGrupo.add(brilloGeo);
      cofreGrupo.userData.brilloInterior = brilloGeo;

      cofreGrupo.position.y = -0.3;
      escenaCofre.add(cofreGrupo);

      // Click en cofre
      const cofreAreaEl = document.getElementById('cofreArea');
      cofreAreaEl.addEventListener('click', abrirCofre);
      cofreAreaEl.addEventListener('touchstart', (e) => { e.preventDefault(); abrirCofre(); });

      animarCofre();
    }

    function animarCofre() {
      requestAnimationFrame(animarCofre);
      if (!cofreGrupo) return;

      // Flotar y rotar suavemente
      const t = Date.now() * 0.001;
      cofreGrupo.rotation.y = Math.sin(t * 0.5) * 0.3;
      cofreGrupo.position.y = -0.3 + Math.sin(t * 1.2) * 0.05;

      // Animar apertura
      if (cofreAbierto && cofreGrupo.userData.tapaAng < 1.8) {
        cofreGrupo.userData.tapaAng += 0.04;
        cofreGrupo.userData.tapa.rotation.x = -cofreGrupo.userData.tapaAng;
        cofreGrupo.userData.brilloInterior.intensity = Math.min(cofreGrupo.userData.tapaAng * 2, 4);
      }

      rendererCofre.render(escenaCofre, camaraCofre);
    }

    function abrirCofre() {
      if (cofreAbierto) return;
      cofreAbierto = true;

      // Mostrar texto
      document.getElementById('felizSV').classList.add('mostrar');

      // Lanzar fuegos artificiales
      lanzarFuegos();

      // Mostrar QR despues de 2 segundos
      setTimeout(() => {
        document.getElementById('qrOverlay').classList.add('activo');
      }, 2500);
    }

    window.cerrarQR = function() {
      document.getElementById('qrOverlay').classList.remove('activo');
    };

    function lanzarFuegos() {
      const container = document.getElementById('fuegosContainer');
      const colores = ['#ff1493', '#ff69b4', '#ffd700', '#ff4444', '#da70d6', '#00bfff', '#ff6b8a', '#ffaa00'];

      function crearFuego() {
        const x = Math.random() * window.innerWidth;
        const yBase = window.innerHeight * 0.3 + Math.random() * window.innerHeight * 0.3;

        // Trail subiendo
        const trail = document.createElement('div');
        trail.className = 'fuego-trail';
        trail.style.left = x + 'px';
        trail.style.bottom = '0px';
        trail.style.background = `linear-gradient(to top, transparent, ${colores[Math.floor(Math.random() * colores.length)]})`;
        container.appendChild(trail);

        setTimeout(() => {
          trail.remove();

          // Explosion
          const fuego = document.createElement('div');
          fuego.className = 'fuego';
          fuego.style.left = x + 'px';
          fuego.style.top = (window.innerHeight - yBase) + 'px';

          const numPart = 25 + Math.floor(Math.random() * 15);
          for (let i = 0; i < numPart; i++) {
            const p = document.createElement('div');
            p.className = 'fuego-particula';
            const angulo = (i / numPart) * Math.PI * 2;
            const dist = 50 + Math.random() * 100;
            const fx = Math.cos(angulo) * dist;
            const fy = Math.sin(angulo) * dist + Math.random() * 30;
            p.style.setProperty('--fx', fx + 'px');
            p.style.setProperty('--fy', fy + 'px');
            const color = colores[Math.floor(Math.random() * colores.length)];
            p.style.backgroundColor = color;
            p.style.boxShadow = `0 0 6px ${color}, 0 0 12px ${color}`;
            p.style.width = (3 + Math.random() * 4) + 'px';
            p.style.height = p.style.width;
            fuego.appendChild(p);
          }

          container.appendChild(fuego);
          setTimeout(() => fuego.remove(), 1600);
        }, 600);
      }

      // Lanzar multiples fuegos
      for (let i = 0; i < 5; i++) {
        setTimeout(crearFuego, i * 400);
      }
      // Segunda ronda
      setTimeout(() => {
        for (let i = 0; i < 4; i++) {
          setTimeout(crearFuego, i * 500);
        }
      }, 2500);
      // Tercera ronda
      setTimeout(() => {
        for (let i = 0; i < 3; i++) {
          setTimeout(crearFuego, i * 600);
        }
      }, 5000);
    }

    // Efecto de destello al hacer click
    function iniciarDestellos() {
      const container = document.getElementById('pantallaFinalContainer');

      function crearDestello(x, y) {
        const colores = ['#ff1493', '#ff69b4', '#da70d6', '#ffd700', '#00bfff', '#ffffff', '#ff6b8a', '#ba55d3'];
        const destello = document.createElement('div');
        destello.className = 'destello';
        destello.style.left = x + 'px';
        destello.style.top = y + 'px';

        // Onda expansiva
        const onda = document.createElement('div');
        onda.className = 'destello-onda';
        onda.style.borderColor = colores[Math.floor(Math.random() * colores.length)];
        destello.appendChild(onda);

        // Particulas que explotan
        for (let i = 0; i < 14; i++) {
          const p = document.createElement('div');
          p.className = 'destello-particula';
          const angulo = (i / 14) * Math.PI * 2;
          const dist = 40 + Math.random() * 60;
          const dx = Math.cos(angulo) * dist;
          const dy = Math.sin(angulo) * dist;
          p.style.setProperty('--dx', dx + 'px');
          p.style.setProperty('--dy', dy + 'px');
          p.style.backgroundColor = colores[Math.floor(Math.random() * colores.length)];
          p.style.boxShadow = `0 0 6px ${p.style.backgroundColor}`;
          p.style.width = (3 + Math.random() * 5) + 'px';
          p.style.height = p.style.width;
          destello.appendChild(p);
        }

        document.body.appendChild(destello);
        setTimeout(() => destello.remove(), 1000);
      }

      container.addEventListener('click', (e) => {
        crearDestello(e.clientX, e.clientY);
      });

      container.addEventListener('touchstart', (e) => {
        const touch = e.touches[0];
        crearDestello(touch.clientX, touch.clientY);
      });
    }

    // Parallax para fotos de boda
    function iniciarParallaxBoda() {
      const fotos = document.querySelectorAll('.foto-boda');
      const container = document.getElementById('bodaContainer');

      function aplicarParallax(offsetX, offsetY) {
        fotos.forEach((foto) => {
          const depth = parseFloat(foto.dataset.parallaxBoda);
          const moveX = offsetX * depth * 20;
          const moveY = offsetY * depth * 12;
          const rotateY = offsetX * depth * 8;
          const rotateX = -offsetY * depth * 6;

          foto.style.transform = `
            translate(${moveX}px, ${moveY}px)
            rotateY(${rotateY}deg)
            rotateX(${rotateX}deg)
            scale(1)
          `;
        });
      }

      container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        const offsetX = (e.clientX - rect.left - rect.width / 2) / (rect.width / 2);
        const offsetY = (e.clientY - rect.top - rect.height / 2) / (rect.height / 2);
        aplicarParallax(offsetX, offsetY);
      });

      container.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const rect = container.getBoundingClientRect();
        const offsetX = (touch.clientX - rect.left - rect.width / 2) / (rect.width / 2);
        const offsetY = (touch.clientY - rect.top - rect.height / 2) / (rect.height / 2);
        aplicarParallax(offsetX, offsetY);
      });
    }

    // Parallax para las postales
    function iniciarParallaxPostales() {
      const postales = document.querySelectorAll('.postal');
      const container = document.getElementById('postalesContainer');

      container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const offsetX = (e.clientX - rect.left - centerX) / centerX;
        const offsetY = (e.clientY - rect.top - centerY) / centerY;

        postales.forEach((postal) => {
          const depth = parseFloat(postal.dataset.parallax);
          const moveX = offsetX * depth * 25;
          const moveY = offsetY * depth * 15;
          const rotateY = offsetX * depth * 5;
          const rotateX = -offsetY * depth * 5;

          const baseRotations = { 1: -8, 2: 5, 3: -3 };
          const baseRotate = baseRotations[depth] || 0;

          postal.style.transform = `
            translate(${moveX}px, ${moveY}px)
            rotate(${baseRotate + rotateY * 0.3}deg)
            rotateY(${rotateY}deg)
            rotateX(${rotateX}deg)
            translateZ(${depth * 20}px)
          `;
        });
      });

      // Touch parallax para movil
      container.addEventListener('touchmove', (e) => {
        const touch = e.touches[0];
        const rect = container.getBoundingClientRect();
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const offsetX = (touch.clientX - rect.left - centerX) / centerX;
        const offsetY = (touch.clientY - rect.top - centerY) / centerY;

        postales.forEach((postal) => {
          const depth = parseFloat(postal.dataset.parallax);
          const moveX = offsetX * depth * 25;
          const moveY = offsetY * depth * 15;
          const rotateY = offsetX * depth * 5;
          const rotateX = -offsetY * depth * 5;

          const baseRotations = { 1: -8, 2: 5, 3: -3 };
          const baseRotate = baseRotations[depth] || 0;

          postal.style.transform = `
            translate(${moveX}px, ${moveY}px)
            rotate(${baseRotate + rotateY * 0.3}deg)
            rotateY(${rotateY}deg)
            rotateX(${rotateX}deg)
            translateZ(${depth * 20}px)
          `;
        });
      });
    }

    // Zoom de fotos al hacer click
    window.cerrarZoom = function() {
      const overlay = document.getElementById('fotoZoom');
      overlay.classList.remove('activo');
      setTimeout(() => { overlay.style.display = 'none'; }, 400);
    };

    document.addEventListener('click', (e) => {
      const img = e.target;
      if (img.tagName === 'IMG' && (img.closest('.postal') || img.closest('.foto-boda'))) {
        e.stopPropagation();
        const overlay = document.getElementById('fotoZoom');
        const zoomImg = document.getElementById('fotoZoomImg');
        zoomImg.src = img.src;
        overlay.style.display = 'flex';
        requestAnimationFrame(() => {
          overlay.classList.add('activo');
        });
      }
    });

    // === MUSICA DE FONDO ROM√ÅNTICA ===
    class MusicaFondo {
      constructor() {
        this.audioCtx = null;
        this.isPlaying = false;
        this.intervalId = null;
        this.notaActual = 0;
        this.notas = [
          { nota: 'C4', duracion: 1.5 },
          { nota: 'E4', duracion: 1.5 },
          { nota: 'G4', duracion: 1.5 },
          { nota: 'B4', duracion: 1.5 },
          { nota: 'C5', duracion: 1.5 },
          { nota: 'B4', duracion: 1.5 },
          { nota: 'G4', duracion: 1.5 },
          { nota: 'E4', duracion: 1.5 },
          { nota: 'D4', duracion: 1.5 },
          { nota: 'F#4', duracion: 1.5 },
          { nota: 'A4', duracion: 1.5 },
          { nota: 'C5', duracion: 1.5 },
          { nota: 'B4', duracion: 1.5 },
          { nota: 'A4', duracion: 1.5 },
          { nota: 'F#4', duracion: 1.5 },
          { nota: 'D4', duracion: 1.5 },
          { nota: 'E4', duracion: 1.5 },
          { nota: 'G4', duracion: 1.5 },
          { nota: 'C5', duracion: 1.5 },
          { nota: 'A4', duracion: 1.5 },
          { nota: 'G4', duracion: 1.5 },
          { nota: 'E4', duracion: 1.5 },
          { nota: 'D4', duracion: 1.5 },
          { nota: 'C4', duracion: 3 }
        ];
        this.frecuencias = {
          'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23,
          'F#4': 369.99, 'G4': 392.00, 'G#4': 415.30, 'A4': 440.00,
          'A#4': 466.16, 'B4': 493.88, 'C5': 523.25, 'D5': 587.33,
          'E5': 659.25
        };
      }

      iniciar() {
        if (this.isPlaying) return;
        
        this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        this.isPlaying = true;
        this.notaActual = 0;
        this.reproducirNota();
        
        this.intervalId = setInterval(() => {
          this.reproducirNota();
        }, 1500);
      }

      reproducirNota() {
        if (!this.audioCtx || this.notaActual >= this.notas.length) {
          this.notaActual = 0;
        }

        const notaActual = this.notas[this.notaActual];
        const freq = this.frecuencias[notaActual.nota];
        const duracion = notaActual.duracion;

        this.tocarNota(freq, duracion * 0.9);
        this.notaActual++;
      }

      tocarNota(frecuencia, duracion) {
        if (!this.audioCtx) return;

        const oscilador = this.audioCtx.createOscillator();
        const ganancia = this.audioCtx.createGain();
        const osciladorArmonico = this.audioCtx.createOscillator();
        const gananciaArmonica = this.audioCtx.createGain();

        oscilador.type = 'sine';
        oscilador.frequency.value = frecuencia;
        
        osciladorArmonico.type = 'sine';
        osciladorArmonico.frequency.value = frecuencia * 2;

        ganancia.gain.setValueAtTime(0, this.audioCtx.currentTime);
        ganancia.gain.linearRampToValueAtTime(0.15, this.audioCtx.currentTime + 0.1);
        ganancia.gain.exponentialRampToValueAtTime(0.01, this.audioCtx.currentTime + duracion);

        gananciaArmonica.gain.setValueAtTime(0, this.audioCtx.currentTime);
        gananciaArmonica.gain.linearRampToValueAtTime(0.03, this.audioCtx.currentTime + 0.1);
        gananciaArmonica.gain.exponentialRampToValueAtTime(0.001, this.audioCtx.currentTime + duracion * 0.7);

        oscilador.connect(ganancia);
        ganancia.connect(this.audioCtx.destination);
        
        osciladorArmonico.connect(gananciaArmonica);
        gananciaArmonica.connect(this.audioCtx.destination);

        oscilador.start(this.audioCtx.currentTime);
        oscilador.stop(this.audioCtx.currentTime + duracion);
        
        osciladorArmonico.start(this.audioCtx.currentTime);
        osciladorArmonico.stop(this.audioCtx.currentTime + duracion * 0.7);
      }

      detener() {
        if (this.intervalId) {
          clearInterval(this.intervalId);
          this.intervalId = null;
        }
        if (this.audioCtx) {
          this.audioCtx.close();
          this.audioCtx = null;
        }
        this.isPlaying = false;
      }
    }

    const musicaFondo = new MusicaFondo();

    let musicaIniciada = false;
    document.addEventListener('click', () => {
      if (!musicaIniciada) {
        musicaFondo.iniciar();
        musicaIniciada = true;
      }
    }, { once: false });

    document.addEventListener('touchstart', () => {
      if (!musicaIniciada) {
        musicaFondo.iniciar();
        musicaIniciada = true;
      }
    }, { once: false });


    
  </script>
<script>
  var loadingTimeout;
  function hideLoading() {
    if (!document.getElementById("loadingScreen").classList.contains("hidden")) {
      document.getElementById("loadingScreen").classList.add("hidden");
      clearTimeout(loadingTimeout);
    }
  }
  window.addEventListener("load", hideLoading);
  loadingTimeout = setTimeout(hideLoading, 15000);
</script>

</body>
</html>
