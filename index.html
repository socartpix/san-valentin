<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carta de San Valent√≠n</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      overflow: hidden; 
      background: linear-gradient(135deg, #1a0a1e 0%, #2d1b30 50%, #1a0a1e 100%);
      font-family: 'Georgia', serif; 
      min-height: 100vh;
    }
    canvas { display: block; position: fixed; top: 0; left: 0; }
    
    .pantalla {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.8s ease;
      z-index: 10;
    }
    
    .pantalla.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .pantalla.oculta {
      opacity: 0;
      pointer-events: none;
    }

    /* Estilos del Sobre */
    .envelope-container {
      position: relative;
      width: 320px;
      height: 220px;
      cursor: pointer;
      perspective: 1000px;
    }

    .envelope {
      position: absolute;
      width: 100%;
      height: 100%;
      transform-style: preserve-3d;
    }

    .envelope-body {
      position: absolute;
      width: 100%;
      height: 100%;
      background: linear-gradient(145deg, #d4a5a5 0%, #c99696 50%, #b87a7a 100%);
      border-radius: 0 0 15px 15px;
      box-shadow: 
        inset 0 -5px 15px rgba(0,0,0,0.1),
        0 10px 30px rgba(0,0,0,0.3);
    }

    .envelope-body::before,
    .envelope-body::after {
      content: '';
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      background: linear-gradient(135deg, #c99696 0%, #b87a7a 100%);
    }

    .envelope-body::before {
      left: 0;
      border-radius: 0 0 0 15px;
      transform: skewY(15deg);
      transform-origin: top right;
    }

    .envelope-body::after {
      right: 0;
      border-radius: 0 0 15px 0;
      transform: skewY(-15deg);
      transform-origin: top left;
    }

    .envelope-flap {
      position: absolute;
      top: 0;
      width: 100%;
      height: 110px;
      background: linear-gradient(180deg, #e8c4c4 0%, #d4a5a5 50%, #c99696 100%);
      clip-path: polygon(0 0, 50% 100%, 100% 0);
      transform-origin: top;
      transition: transform 0.8s ease;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 2;
    }

    .envelope.open .envelope-flap {
      transform: rotateX(180deg) translateY(-5px);
    }

    .envelope-inner {
      position: absolute;
      bottom: 0;
      left: 5%;
      width: 90%;
      height: 70%;
      background: #fff5f5;
      border-radius: 10px;
      transform: translateY(0);
      transition: transform 0.8s ease;
      box-shadow: inset 0 0 20px rgba(255,182,193,0.3);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1;
    }

    .envelope.open .envelope-inner {
      transform: translateY(-120px) rotateX(-10deg);
    }

    .carta-contenido {
      text-align: center;
      padding: 20px;
      color: #8b4557;
      opacity: 0;
      transition: opacity 0.5s ease 0.5s;
    }

    .envelope.open .carta-contenido {
      opacity: 1;
    }

    .carta-contenido h2 {
      font-size: 1.2rem;
      margin-bottom: 10px;
      color: #c99696;
    }

    .corazon-small {
      font-size: 2rem;
      animation: heartbeat 1s infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .click-hint {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      color: #d4a5a5;
      font-size: 0.9rem;
      white-space: nowrap;
      animation: pulse-hint 2s infinite;
    }

    @keyframes pulse-hint {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    /* Mensaje de la primera pantalla */
    .mensaje {
      color: #ffd4e5;
      font-size: clamp(1.2rem, 4vw, 2rem);
      text-align: center;
      max-width: 80%;
      line-height: 1.8;
      text-shadow: 0 0 30px #ff1493, 0 0 60px #ff0066;
      padding: 20px;
    }

    .mensaje-final {
      font-size: clamp(2rem, 8vw, 4rem);
      color: #ff69b4;
      text-shadow: 0 0 40px #ff1493, 0 0 80px #ff0066, 0 0 120px #ff69b4;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .btn-siguiente {
      margin-top: 40px;
      padding: 15px 50px;
      font-size: 1.2rem;
      background: linear-gradient(45deg, #ff1493, #ff69b4);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 30px;
      color: white;
      cursor: pointer;
      z-index: 20;
      box-shadow: 0 0 30px rgba(255, 105, 180, 0.5);
      transition: all 0.3s ease;
      font-family: 'Georgia', serif;
    }

    .btn-siguiente:hover {
      transform: scale(1.1);
      box-shadow: 0 0 50px #ff1493;
    }

    .rosa-decorativa {
      position: absolute;
      font-size: 3rem;
      opacity: 0.6;
      animation: flotar 4s ease-in-out infinite;
      filter: drop-shadow(0 0 10px #ff1493);
    }

    @keyframes flotar {
      0%, 100% { transform: translateY(0) rotate(0deg); }
      50% { transform: translateY(-20px) rotate(10deg); }
    }

    .indicador-pestanas {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 30;
    }

    .punto {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255, 105, 180, 0.3);
      transition: all 0.5s ease;
    }

    .punto.activo {
      background: #ff69b4;
      box-shadow: 0 0 15px #ff1493;
      transform: scale(1.3);
    }

    .corazon-sello {
      position: absolute;
      top: -20px;
      right: 30px;
      font-size: 2rem;
      z-index: 3;
      filter: drop-shadow(0 2px 5px rgba(0,0,0,0.2));
    }
  </style>
</head>
<body>
  <div id="escena-3d"></div>

  <!-- Pantalla 0: Sobre -->
  <div class="pantalla visible" id="pantalla0">
    <div class="envelope-container" onclick="abrirCarta()">
      <div class="envelope" id="envelope">
        <div class="corazon-sello">üíï</div>
        <div class="envelope-flap"></div>
        <div class="envelope-inner">
          <div class="carta-contenido">
            <h2>Para ti ‚ù§Ô∏è</h2>
            <span class="corazon-small">üíå</span>
          </div>
        </div>
        <div class="envelope-body"></div>
      </div>
      <span class="click-hint">Toca para abrir</span>
    </div>
  </div>

  <!-- Pantalla 1: Mensaje -->
  <div class="pantalla" id="pantalla1">
    <div class="rosa-decorativa" style="top: 10%; left: 10%; animation-delay: 0s;">üåπ</div>
    <div class="rosa-decorativa" style="top: 20%; right: 15%; animation-delay: 1s;">üåπ</div>
    <div class="rosa-decorativa" style="bottom: 20%; left: 20%; animation-delay: 2s;">üåπ</div>
    <div class="rosa-decorativa" style="bottom: 30%; right: 10%; animation-delay: 0.5s;">üåπ</div>
    <div class="rosa-decorativa" style="top: 50%; left: 5%; animation-delay: 1.5s;">üå∏</div>
    <div class="rosa-decorativa" style="top: 40%; right: 5%; animation-delay: 2.5s;">üå∏</div>
    
    <p class="mensaje">
      No puedo dejar a mi esposa que no reciba flores este d√≠a.<br><br>
      Gracias por estar conmigo.<br>
      Tenemos una gran vida por delante<br>
      y gracias por acompa√±arme en estos momentos.
    </p>
    <button class="btn-siguiente" onclick="siguientePantalla()">Continuar ‚ù§Ô∏è</button>
  </div>

  <!-- Pantalla 2: Te amo -->
  <div class="pantalla" id="pantalla2">
    <p class="mensaje-final">Te amo ‚ù§Ô∏è</p>
  </div>

  <div class="indicador-pestanas">
    <div class="punto activo" id="punto1"></div>
    <div class="punto" id="punto2"></div>
    <div class="punto" id="punto3"></div>
  </div>

  <script type="importmap">
  {
    "imports": {
      "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
    }
  }
  </script>

  <script type="module">
    import * as THREE from 'three';

    let escena, camara, renderer, rosas = [], tiempo = 0;

    function init() {
      escena = new THREE.Scene();
      camara = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camara.position.z = 6;

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
      document.getElementById('escena-3d').appendChild(renderer.domElement);

      const luz1 = new THREE.PointLight(0xff1493, 3, 50);
      luz1.position.set(3, 3, 5);
      escena.add(luz1);

      const luz2 = new THREE.PointLight(0xff69b4, 2, 50);
      luz2.position.set(-3, -2, 3);
      escena.add(luz2);

      escena.add(new THREE.AmbientLight(0x2a0a1a, 0.8));

      crearRosas();
      crearParticulas();
      crearPetalos();

      window.addEventListener('resize', onResize);
      window.addEventListener('mousemove', onMouseMove);
    }

    function crearRosas() {
      const posiciones = [
        { x: -3, y: 2, z: -2 },
        { x: 3.5, y: 1.5, z: -3 },
        { x: -2.5, y: -1.5, z: -1 },
        { x: 2, y: -2, z: -2 },
        { x: 0, y: 2.5, z: -4 },
        { x: -1.5, y: -2.5, z: -3 },
        { x: 1.5, y: 2, z: -5 },
      ];

      posiciones.forEach((pos, i) => {
        const rosa = crearRosa();
        rosa.position.set(pos.x, pos.y, pos.z);
        rosa.rotation.y = Math.random() * Math.PI * 2;
        rosa.userData = { rotacionBase: rosa.rotation.y, delay: i * 0.5 };
        rosas.push(rosa);
        escena.add(rosa);
      });
    }

    function crearRosa() {
      const grupo = new THREE.Group();

      const geometriaTallo = new THREE.CylinderGeometry(0.02, 0.03, 1.5, 8);
      const materialTallo = new THREE.MeshPhongMaterial({ 
        color: 0x228b22,
        shininess: 30
      });
      const tallo = new THREE.Mesh(geometriaTallo, materialTallo);
      tallo.position.y = -0.5;
      grupo.add(tallo);

      const coloresPetalos = [0xff0066, 0xff1493, 0xff69b4, 0xcc1144];
      const colorPetalos = coloresPetalos[Math.floor(Math.random() * coloresPetalos.length)];

      for (let i = 0; i < 15; i++) {
        const escala = 0.15 + Math.random() * 0.1;
        const geometria = new THREE.SphereGeometry(escala, 16, 16);
        const material = new THREE.MeshPhongMaterial({
          color: colorPetalos,
          transparent: true,
          opacity: 0.85,
          shininess: 80,
          emissive: colorPetalos,
          emissiveIntensity: 0.1
        });
        const petalo = new THREE.Mesh(geometria, material);
        
        const angulo = (i / 15) * Math.PI * 2;
        const radio = 0.05 + Math.random() * 0.08;
        petalo.position.set(
          Math.cos(angulo) * radio,
          0.1 + Math.random() * 0.15,
          Math.sin(angulo) * radio
        );
        petalo.rotation.set(
          Math.random() * 0.5 - 0.25,
          Math.random() * 0.5 - 0.25,
          Math.random() * 0.5 - 0.25
        );
        grupo.add(petalo);
      }

      const centroGeo = new THREE.SphereGeometry(0.12, 16, 16);
      const centroMat = new THREE.MeshPhongMaterial({
        color: 0xff0044,
        transparent: true,
        opacity: 0.9,
        shininess: 100
      });
      const centro = new THREE.Mesh(centroGeo, centroMat);
      centro.position.y = 0.15;
      grupo.add(centro);

      for (let i = 0; i < 5; i++) {
        const hojaGeo = new THREE.PlaneGeometry(0.15, 0.25);
        const hojaMat = new THREE.MeshPhongMaterial({
          color: 0x228b22,
          transparent: true,
          opacity: 0.7,
          side: THREE.DoubleSide,
          shininess: 20
        });
        const hoja = new THREE.Mesh(hojaGeo, hojaMat);
        hoja.position.y = -0.3 - i * 0.2;
        hoja.rotation.y = i * 1.2;
        hoja.rotation.x = 0.3;
        grupo.add(hoja);
      }

      return grupo;
    }

    function crearPetalos() {
      const geometria = new THREE.BufferGeometry();
      const vertices = [];
      const colores = [];

      for (let i = 0; i < 200; i++) {
        vertices.push(
          (Math.random() - 0.5) * 15,
          (Math.random() - 0.5) * 15,
          (Math.random() - 0.5) * 10 - 5
        );
        
        const color = new THREE.Color();
        color.setHSL(0.95 + Math.random() * 0.05, 0.8, 0.6 + Math.random() * 0.3);
        colores.push(color.r, color.g, color.b);
      }

      geometria.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      geometria.setAttribute('color', new THREE.Float32BufferAttribute(colores, 3));

      const material = new THREE.PointsMaterial({
        size: 0.08,
        vertexColors: true,
        transparent: true,
        opacity: 0.7,
        blending: THREE.AdditiveBlending
      });

      const petalos = new THREE.Points(geometria, material);
      petalos.userData = { tipo: 'petalos' };
      escena.add(petalos);
    }

    function crearParticulas() {
      const geometria = new THREE.BufferGeometry();
      const vertices = [];

      for (let i = 0; i < 300; i++) {
        vertices.push(
          (Math.random() - 0.5) * 20,
          (Math.random() - 0.5) * 20,
          (Math.random() - 0.5) * 20
        );
      }

      geometria.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
      const material = new THREE.PointsMaterial({
        color: 0xffb6c1,
        size: 0.03,
        transparent: true,
        opacity: 0.6
      });
      const particulas = new THREE.Points(geometria, material);
      particulas.userData = { tipo: 'particulas' };
      escena.add(particulas);
    }

    let mouseX = 0, mouseY = 0;

    function onMouseMove(event) {
      mouseX = (event.clientX / window.innerWidth) * 2 - 1;
      mouseY = -(event.clientY / window.innerHeight) * 2 + 1;
    }

    function animate() {
      requestAnimationFrame(animate);
      tiempo += 0.008;

      camara.position.x += (mouseX * 0.5 - camara.position.x) * 0.02;
      camara.position.y += (mouseY * 0.3 - camara.position.y) * 0.02;
      camara.lookAt(escena.position);

      rosas.forEach((rosa, i) => {
        rosa.rotation.y = rosa.userData.rotacionBase + Math.sin(tiempo + rosa.userData.delay) * 0.3;
        rosa.position.y += Math.sin(tiempo * 2 + i) * 0.001;
      });

      escena.children.forEach(child => {
        if (child.userData.tipo === 'petalos') {
          child.rotation.y += 0.0005;
          child.rotation.x = Math.sin(tiempo * 0.5) * 0.1;
        }
        if (child.userData.tipo === 'particulas') {
          child.rotation.y += 0.001;
        }
      });

      renderer.render(escena, camara);
    }

    function onResize() {
      camara.aspect = window.innerWidth / window.innerHeight;
      camara.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    init();
    animate();

    window.abrirCarta = function() {
      const envelope = document.getElementById('envelope');
      envelope.classList.add('open');
      
      setTimeout(() => {
        const p0 = document.getElementById('pantalla0');
        const p1 = document.getElementById('pantalla1');
        
        p0.classList.remove('visible');
        p0.classList.add('oculta');
        
        setTimeout(() => {
          p0.style.display = 'none';
          p1.style.display = 'flex';
          
          setTimeout(() => {
            p1.classList.add('visible');
            document.getElementById('punto1').classList.add('activo');
          }, 100);
        }, 300);
      }, 1200);
    };

    window.siguientePantalla = function() {
      const p1 = document.getElementById('pantalla1');
      const p2 = document.getElementById('pantalla2');
      
      p1.classList.remove('visible');
      p1.classList.add('oculta');

      setTimeout(() => {
        p1.style.display = 'none';
        p2.style.display = 'flex';
        
        setTimeout(() => {
          p2.classList.add('visible');
          document.getElementById('punto1').classList.remove('activo');
          document.getElementById('punto2').classList.add('activo');
        }, 100);
      }, 500);
    };
  </script>
</body>
</html>
